<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FalakZoom</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: black;
        font-family: "Poppins", "Cairo", Arial, sans-serif; /* Added Cairo */
      }

      #infoPanel {
        position: absolute;
        top: 70px;
        left: 20px;
        background: rgba(0, 0, 0, 0.88); /* Slightly more opaque */
        color: white;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        display: none;
        max-width: 400px; /* Slightly wider for more content */
        max-height: calc(100vh - 90px); /* Max height */
        overflow-y: auto; /* Allow scrolling if content exceeds height */
        font-size: 14px;
        line-height: 1.7;
        z-index: 50;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        scrollbar-width: thin; /* Firefox */
        scrollbar-color: rgba(255, 255, 255, 0.3) rgba(0, 0, 0, 0.5); /* Firefox */
      }
      /* Webkit scrollbar styles */
      #infoPanel::-webkit-scrollbar {
        width: 8px;
      }
      #infoPanel::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
      }
      #infoPanel::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        border: 2px solid rgba(0, 0, 0, 0.5);
      }

      #infoPanel h2 {
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 18px;
        font-weight: 600;
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        padding-bottom: 8px;
      }

      #infoPanel p {
        margin-bottom: 10px;
      }

      #infoPanel .fact {
        font-style: italic;
        color: #cccccc;
        margin-top: 15px;
        padding-top: 10px;
        border-top: 1px dashed rgba(255, 255, 255, 0.2);
      }

      /* Read More Button Styles */
      #readMoreBtn {
        background-color: rgba(255, 255, 255, 0.15);
        color: #e0e0e0;
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-family: inherit;
        font-size: 13px;
        margin-top: 15px;
        transition: background-color 0.3s, color 0.3s;
        display: block; /* Make it block to take full width if needed */
        width: fit-content; /* Adjust width to content */
      }
      #readMoreBtn:hover {
        background-color: rgba(255, 255, 255, 0.25);
        color: white;
      }

      /* Extra Facts Container Styles */
      #extraFactsContainer {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.3);
      }
      #extraFactsContainer p {
        font-size: 13px; /* Slightly smaller */
        color: #bbbbbb; /* Slightly dimmer */
        margin-bottom: 8px;
        padding-left: 10px; /* Indent facts */
        position: relative;
      }
      /* Add bullet points visually */
      #extraFactsContainer p::before {
        content: '•';
        position: absolute;
        left: -2px; /* Adjust position based on language direction */
        top: 0;
        color: #66ccff; /* Accent color */
      }
      /* Adjust bullet for RTL */
      [dir="rtl"] #extraFactsContainer p {
        padding-left: 0;
        padding-right: 10px;
      }
      [dir="rtl"] #extraFactsContainer p::before {
        left: auto;
        right: -2px;
      }

      #closeBtn {
        position: absolute;
        top: 10px;
        right: 10px; /* Default to right */
        width: 28px;
        height: 28px;
        font-size: 16px;
        font-weight: bold;
        color: #ff6b6b;
        cursor: pointer;
        transition: transform 0.3s ease, color 0.3s ease,
          background 0.3s ease;
        padding: 0;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 51; /* Ensure it's above content */
      }

      #closeBtn:hover {
        color: #ff4757;
        transform: scale(1.1) rotate(90deg);
        background: rgba(255, 255, 255, 0.2);
      }

      #menuBar {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 50px;
        background: rgba(0, 0, 0, 0.8);
        padding: 0 20px;
        box-sizing: border-box;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 100;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }

      .menu-controls {
        display: flex;
        align-items: center;
        gap: 10px; /* Add gap between control groups */
      }

      /* Style for individual menu items and buttons */
      .menu-item, #langToggleBtn, .speed-btn {
        position: relative;
        color: white;
        padding: 8px 15px;
        /* margin-left: 10px; /* Replaced by gap in .menu-controls */
        cursor: pointer;
        font-family: "Poppins", "Cairo", sans-serif;
        border-radius: 4px;
        transition: background 0.3s ease, color 0.3s ease;
        font-size: 14px;
        user-select: none;
        background: rgba(255, 255, 255, 0.1); /* Subtle background */
        border: 1px solid rgba(255, 255, 255, 0.2); /* Subtle border */
        line-height: 1; /* Ensure consistent height */
      }

      .menu-item:hover, #langToggleBtn:hover, .speed-btn:hover {
        background: rgba(255, 255, 255, 0.25); /* Slightly lighter on hover */
        color: #eee;
      }

       /* Specific styles for speed control */
      #speedControl {
        display: flex;
        align-items: center;
        gap: 5px; /* Space between speed buttons and display */
        background-color: rgba(255, 255, 255, 0.05); /* Slightly different bg */
        padding: 4px 8px; /* Padding around the speed control */
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.15);
      }

      .speed-btn {
        padding: 5px 8px; /* Smaller padding for speed buttons */
        font-size: 16px; /* Larger font for arrows */
        font-weight: bold;
        background: rgba(255, 255, 255, 0.15); /* Slightly darker */
        border: 1px solid rgba(255, 255, 255, 0.25);
      }

      #speedDisplay {
        color: #e0e0e0;
        font-size: 14px;
        font-weight: 600;
        padding: 0 8px; /* Padding around the speed text */
        min-width: 30px; /* Ensure space for '8x' */
        text-align: center;
        user-select: none;
      }


      /* UPDATED DROPDOWN STYLE */
      .dropdown {
        position: absolute;
        top: 100%;
        /* REMOVED right: 0; - will be handled by LTR/RTL rules below */
        background: rgba(25, 25, 25, 0.95);
        min-width: 180px;
        /* CHANGED border-radius to apply to all corners */
        border-radius: 6px;
        overflow: hidden;
        display: none;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        /* REMOVED border-top: none; */
        z-index: 110;
      }

      /* ADDED LTR/RTL positioning rules */
      /* Default LTR positioning for the dropdown */
      body[dir="ltr"] .menu-item .dropdown {
        right: 0;
        left: auto;
        /* Optional: If you want sharp top corners touching the menu item in LTR */
        /* border-top-left-radius: 0; */
        /* border-top-right-radius: 0; */
      }

      /* Added RTL positioning for the dropdown */
      body[dir="rtl"] .menu-item .dropdown {
        right: auto; /* Override default */
        left: 0; /* Position from left */
        /* Optional: If you want sharp top corners touching the menu item in RTL */
        /* border-top-left-radius: 0; */
        /* border-top-right-radius: 0; */
      }

      .dropdown.show {
        display: block;
      }

      .dropdown-item {
        padding: 12px 20px;
        color: #e0e0e0;
        text-decoration: none;
        display: block;
        transition: background 0.2s ease, color 0.2s ease;
        font-size: 14px;
        white-space: nowrap;
      }

      .dropdown-item:hover {
        background: rgba(255, 255, 255, 0.15);
        color: white;
      }

      #title {
        color: white;
        font-family: "Poppins", sans-serif;
        font-size: 22px;
        font-weight: 600;
      }

      /* Language Direction Adjustments */
      body[dir="rtl"] #infoPanel {
        left: auto;
        right: 20px;
        text-align: right;
      }
      body[dir="ltr"] #infoPanel {
        left: 20px;
        right: auto;
        text-align: left;
      }
      body[dir="rtl"] #closeBtn {
        left: 10px;
        right: auto;
      }
      body[dir="ltr"] #closeBtn {
        left: auto;
        right: 10px;
      }
      body[dir="rtl"] #readMoreBtn {
        margin-right: auto; /* Align button left in RTL */
      }
      body[dir="ltr"] #readMoreBtn {
        margin-left: auto; /* Align button right in LTR */
      }
       /* Adjust menu controls order for RTL */
       body[dir="rtl"] .menu-controls {
            flex-direction: row-reverse; /* Reverse items for RTL */
       }
       body[dir="rtl"] #speedControl {
            flex-direction: row-reverse; /* Reverse speed buttons for RTL */
       }

    </style>
  </head>
  <body dir="rtl">
    <div id="menuBar">
      <div id="title">FalakZoom</div>
      <div class="menu-controls">
        <div id="langToggleBtn">English</div>

        <div id="speedControl">
            <button id="speedDownBtn" class="speed-btn">&lt;</button> <span id="speedDisplay">1x</span> <button id="speedUpBtn" class="speed-btn">&gt;</button> </div>

        <div class="menu-item" id="planetsMenu">
          الكواكب
          <div class="dropdown" id="planetsDropdown">
            </div>
        </div>
      </div>
    </div>

    <div id="infoPanel">
      <span id="closeBtn">X</span>
      <h2 id="planetName"></h2>
      <p id="planetInfo"></p>
      <p id="planetFact" class="fact"></p>
      <button id="readMoreBtn"></button>
      <div id="extraFactsContainer" style="display: none;">
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
    <script>
      // --- Global Variables ---
      let scene, camera, renderer, controls;
      const planets = [];
      let isFollowingPlanet = false;
      let focusedPlanetIndex = -1;
      let comet;

      // --- Language and UI Text ---
      let currentLanguage = 'ar';
      let currentlyDisplayedPlanetId = null; // Track displayed planet ID

      const uiText = {
        planetsMenu: { ar: "الكواكب", en: "Planets" },
        langToggle: { ar: "English", en: "العربية" },
        readMore: { ar: "اقرأ المزيد", en: "Read More" },
        // Optional: Add text for 'Hide Facts' if implementing toggle later
      };

      // --- Speed Control ---
      const speeds = [1, 2, 4, 8]; // Available speed multipliers
      let currentSpeedIndex = 0; // Index for the speeds array (starts at 1x)
      let speedMultiplier = speeds[currentSpeedIndex]; // Current simulation speed multiplier

      // --- Planet Data ---
      // (Keep the existing planetsData array here - truncated for brevity)
      const planetsData = [
        {
          id: 0, name: { ar: "الشمس", en: "Sun" },
          radius: 5, distance: 0, speed: 0, tilt: 0, rotation: 0.01, texture: "https://threejs.org/examples/textures/planets/sun.jpg", // Example texture
          info: {
            ar: "القطر: 1.391 مليون كيلومتر\nالكتلة: 1.989 × 10³⁰ كيلوغرام\nالعمر: 4.6 مليار سنة\nالنوع: نجم من النوع G\nدرجة حرارة النواة: 15 مليون درجة مئوية",
            en: "Diameter: 1.391 million km\nMass: 1.989 × 10³⁰ kg\nAge: 4.6 billion years\nType: G-type main-sequence star\nCore Temperature: 15 million °C",
          },
          fact: {
            ar: "الشمس تحتوي على 99.86% من كتلة النظام الشمسي وهي مصدر الطاقة الرئيسي للحياة على الأرض.",
            en: "The Sun contains 99.86% of the Solar System's mass and is the primary source of energy for life on Earth.",
          },
          extraFacts: [
             { ar: "تولد الشمس الطاقة من خلال الاندماج النووي، محولة الهيدروجين إلى هيليوم في نواتها.", en: "The Sun generates energy through nuclear fusion, converting hydrogen into helium in its core." },
             { ar: "يستغرق ضوء الشمس حوالي 8 دقائق و 20 ثانية للوصول إلى الأرض.", en: "Light from the Sun takes about 8 minutes and 20 seconds to reach Earth." },
             { ar: "للشمس مجال مغناطيسي قوي يسبب ظواهر مثل البقع الشمسية والتوهجات الشمسية.", en: "The Sun has a powerful magnetic field, which causes phenomena like sunspots and solar flares." }
          ]
        },
        {
          id: 1, name: { ar: "عطارد", en: "Mercury" },
          radius: 0.5, distance: 10, speed: 0.0125, tilt: 0.034, rotation: 0.003, texture: "https://threejs.org/examples/textures/planets/mercury.jpg", // Example texture
          info: {
            ar: "القطر: 4,879 كيلومتر\nالكتلة: 3.3 × 10²³ كيلوغرام\nالمدار: 88 يومًا\nدرجة حرارة السطح: من -173°م إلى 427°م\nلا يوجد غلاف جوي تقريبًا",
            en: "Diameter: 4,879 km\nMass: 3.3 × 10²³ kg\nOrbit: 88 days\nSurface Temp: -173°C to 427°C\nAlmost no atmosphere",
          },
          fact: {
             ar: "يوم واحد على عطارد (دورة شمسية) يستغرق حوالي 176 يومًا أرضيًا بسبب دورانه البطيء ومداره السريع.",
             en: "One solar day on Mercury lasts about 176 Earth days due to its slow rotation and fast orbit."
          },
          extraFacts: [
              { ar: "عطارد هو أصغر كواكب النظام الشمسي ولديه أكبر تقلبات في درجات الحرارة بين الليل والنهار.", en: "Mercury is the smallest planet and has the most extreme temperature fluctuations between day and night." },
              { ar: "يمتلك عطارد نواة حديدية ضخمة بشكل غير متناسب، تشكل حوالي 85% من قطر الكوكب.", en: "Mercury has a disproportionately large iron core, making up about 85% of the planet's radius."},
              { ar: "على الرغم من قربه من الشمس، اكتشف جليد مائي في الفوهات القطبية المظللة بشكل دائم على عطارد.", en: "Despite its proximity to the Sun, water ice has been detected in permanently shadowed polar craters on Mercury." }
          ]
        },
        {
          id: 2, name: { ar: "الزهرة", en: "Venus" },
          radius: 0.8, distance: 15, speed: 0.004375, tilt: 177.4, rotation: 0.0004, texture: "https://threejs.org/examples/textures/planets/venus_atmosphere.jpg", // Example texture
          info: {
            ar: "القطر: 12,104 كيلومتر\nالكتلة: 4.87 × 10²⁴ كيلوغرام\nالمدار: 225 يومًا\nدرجة حرارة السطح: 464°م\nغلاف جوي كثيف من ثاني أكسيد الكربون",
            en: "Diameter: 12,104 km\nMass: 4.87 × 10²⁴ kg\nOrbit: 225 days\nSurface Temp: 464°C\nThick CO2 atmosphere",
          },
          fact: {
              ar: "الزهرة هي أسخن كواكب المجموعة الشمسية وتدور بعكس اتجاه دوران معظم الكواكب الأخرى (حركة تراجعية).",
              en: "Venus is the hottest planet and rotates backwards compared to most other planets (retrograde rotation)."
          },
          extraFacts: [
              { ar: "الضغط الجوي على سطح الزهرة يعادل الضغط الموجود على عمق 900 متر تحت سطح البحر على الأرض.", en: "The atmospheric pressure on Venus's surface is equivalent to the pressure 900 meters underwater on Earth." },
              { ar: "يوم واحد على الزهرة (243 يومًا أرضيًا) أطول من سنته (225 يومًا أرضيًا).", en: "A day on Venus (243 Earth days) is longer than its year (225 Earth days)." },
              { ar: "تتكون سحب الزهرة بشكل أساسي من قطرات حمض الكبريتيك.", en: "Venus's clouds are primarily composed of sulfuric acid droplets." }
          ]
        },
        {
           id: 3, name: { ar: "الأرض", en: "Earth" },
           radius: 1, distance: 20, speed: 0.003125, tilt: 23.5, rotation: 0.05, texture: "https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg", // Example texture
           info: {
             ar: "القطر: 12,742 كيلومتر\nالكتلة: 5.97 × 10²⁴ كيلوغرام\nالمدار: 365.25 يومًا\nدرجة حرارة السطح: من -88°م إلى 58°م\nمغطاة بنسبة 71% بالمياه",
             en: "Diameter: 12,742 km\nMass: 5.97 × 10²⁴ kg\nOrbit: 365.25 days\nSurface Temp: -88°C to 58°C\n71% covered by water",
           },
           fact: {
             ar: "الأرض هي الكوكب الوحيد المعروف حاليًا بوجود حياة ومياه سائلة على سطحه.",
             en: "Earth is the only known planet to host life and have liquid water on its surface."
           },
           extraFacts: [
              { ar: "يحمي المجال المغناطيسي للأرض الكوكب من الإشعاع الشمسي الضار والرياح الشمسية.", en: "Earth's magnetic field protects the planet from harmful solar radiation and solar wind." },
              { ar: "تتكون الأرض من صفائح تكتونية تتحرك باستمرار، مسببة الزلازل والبراكين وتشكل الجبال.", en: "Earth is composed of tectonic plates that constantly move, causing earthquakes, volcanoes, and mountain formation." },
              { ar: "القمر، التابع الطبيعي الوحيد للأرض، يؤثر على المد والجزر ويثبت ميل محور دوران الأرض.", en: "The Moon, Earth's only natural satellite, influences tides and stabilizes Earth's axial tilt." }
           ]
        },
        {
          id: 4, name: { ar: "المريخ", en: "Mars" },
          radius: 0.7, distance: 25, speed: 0.0025, tilt: 25.2, rotation: 0.048, texture: "https://threejs.org/examples/textures/planets/mars_1k_color.jpg", // Example texture
          info: {
            ar: "القطر: 6,792 كيلومتر\nالكتلة: 6.42 × 10²³ كيلوغرام\nالمدار: 687 يومًا\nدرجة حرارة السطح: من -153°م إلى 20°م\nغلاف جوي رقيق من ثاني أكسيد الكربون",
            en: "Diameter: 6,792 km\nMass: 6.42 × 10²³ kg\nOrbit: 687 days\nSurface Temp: -153°C to 20°C\nThin CO2 atmosphere",
          },
          fact: {
            ar: "يُعرف المريخ بالكوكب الأحمر بسبب أكسيد الحديد (الصدأ) على سطحه، ولديه أعلى بركان وأكبر وادي في النظام الشمسي.",
            en: "Mars is known as the Red Planet due to iron oxide (rust) on its surface and has the tallest volcano and largest canyon in the Solar System."
          },
          extraFacts: [
             { ar: "للمريخ قمران صغيران، فوبوس وديموس، يُعتقد أنهما كويكبات تم أسرها.", en: "Mars has two small moons, Phobos and Deimos, which are thought to be captured asteroids." },
             { ar: "توجد أدلة قوية على وجود مياه سائلة على سطح المريخ في الماضي، وربما لا تزال موجودة تحت السطح.", en: "There is strong evidence that liquid water existed on Mars' surface in the past, and may still exist underground." },
             { ar: "تحدث على المريخ أكبر العواصف الترابية في النظام الشمسي، ويمكن أن تغطي الكوكب بأكمله.", en: "Mars experiences the largest dust storms in the Solar System, which can sometimes cover the entire planet." }
          ]
        },
        {
          id: 5, name: { ar: "المشتري", en: "Jupiter" },
          radius: 2.5, distance: 35, speed: 0.00125, tilt: 3.1, rotation: 0.1, texture: "https://threejs.org/examples/textures/planets/jupiter.jpg", // Example texture
          info: {
            ar: "القطر: 139,820 كيلومتر\nالكتلة: 1.898 × 10²⁷ كيلوغرام\nالمدار: 11.86 سنة\nدرجة حرارة السطح (قمم السحب): -145°م\nعملاق غازي",
            en: "Diameter: 139,820 km\nMass: 1.898 × 10²⁷ kg\nOrbit: 11.86 years\nCloud Top Temp: -145°C\nGas giant",
          },
          fact: {
            ar: "المشتري هو أكبر كواكب المجموعة الشمسية وبه البقعة الحمراء العظيمة، وهي عاصفة ضخمة مستمرة منذ قرون.",
            en: "Jupiter is the largest planet and features the Great Red Spot, a giant storm raging for centuries."
          },
          extraFacts: [
             { ar: "يمتلك المشتري أقوى مجال مغناطيسي بين جميع الكواكب، وهو أقوى بحوالي 20,000 مرة من مجال الأرض.", en: "Jupiter has the strongest magnetic field of any planet, about 20,000 times stronger than Earth's." },
             { ar: "يدور المشتري حول محوره أسرع من أي كوكب آخر، حيث يكمل دورة واحدة في أقل من 10 ساعات.", en: "Jupiter rotates faster than any other planet, completing one rotation in just under 10 hours." },
             { ar: "للمشتري 95 قمرًا مؤكدًا على الأقل، بما في ذلك الأقمار الجاليلية الأربعة الكبيرة: آيو، أوروبا، جانيميد، وكاليستو.", en: "Jupiter has at least 95 confirmed moons, including the four large Galilean moons: Io, Europa, Ganymede, and Callisto." }
          ]
        },
        // ... Add other planets similarly (Saturn, Uranus, Neptune) ...
         {
           id: 6, name: { ar: "زحل", en: "Saturn" },
           radius: 2.2, distance: 45, speed: 0.0008, tilt: 26.7, rotation: 0.09, texture: "https://threejs.org/examples/textures/planets/saturn.jpg", // Example texture
           info: {
             ar: "القطر: 116,460 كيلومتر\nالكتلة: 5.68 × 10²⁶ كيلوغرام\nالمدار: 29.45 سنة\nدرجة حرارة السطح (قمم السحب): -178°م\nمعروف بحلقاته المذهلة",
             en: "Diameter: 116,460 km\nMass: 5.68 × 10²⁶ kg\nOrbit: 29.45 years\nCloud Top Temp: -178°C\nKnown for its stunning rings",
           },
           fact: {
             ar: "حلقات زحل ليست صلبة ولكنها تتكون من بلايين القطع من الجليد والصخور، تتراوح في الحجم من حبيبات الغبار إلى حجم المنازل.",
             en: "Saturn's rings are not solid but are made of billions of pieces of ice and rock, ranging in size from dust grains to house-sized boulders."
           },
           extraFacts: [
              { ar: "زحل هو أقل الكواكب كثافة في النظام الشمسي؛ كثافته أقل من كثافة الماء.", en: "Saturn is the least dense planet in the Solar System; it would float in water (if you could find a bathtub large enough!)." },
              { ar: "يمتلك زحل أكبر عدد من الأقمار في النظام الشمسي، مع 146 قمرًا معروفًا.", en: "Saturn has the most moons in the Solar System, with 146 known moons." },
              { ar: "تيتان، أكبر أقمار زحل، هو القمر الوحيد في النظام الشمسي الذي يمتلك غلافًا جويًا كثيفًا وبحيرات سائلة على سطحه (من الميثان والإيثان).", en: "Titan, Saturn's largest moon, is the only moon in the Solar System with a dense atmosphere and liquid lakes on its surface (of methane and ethane)." }
           ]
         },
         {
           id: 7, name: { ar: "أورانوس", en: "Uranus" },
           radius: 1.8, distance: 55, speed: 0.0005, tilt: 97.8, rotation: 0.07, texture: "https://threejs.org/examples/textures/planets/uranus.jpg", // Example texture
           info: {
             ar: "القطر: 50,724 كيلومتر\nالكتلة: 8.68 × 10²⁵ كيلوغرام\nالمدار: 84 سنة\nدرجة حرارة السطح (قمم السحب): -224°م\nعملاق جليدي يميل على جانبه",
             en: "Diameter: 50,724 km\nMass: 8.68 × 10²⁵ kg\nOrbit: 84 years\nCloud Top Temp: -224°C\nIce giant tilted on its side",
           },
           fact: {
             ar: "يدور أورانوس حول الشمس على جانبه، بميل محوري يبلغ حوالي 98 درجة، مما يؤدي إلى فصول متطرفة.",
             en: "Uranus orbits the Sun on its side, with an axial tilt of about 98 degrees, leading to extreme seasons."
           },
           extraFacts: [
              { ar: "يُعتقد أن اللون الأزرق والأخضر لأورانوس ناتج عن وجود الميثان في غلافه الجوي، والذي يمتص الضوء الأحمر.", en: "Uranus's blue-green color is thought to be caused by methane in its atmosphere, which absorbs red light." },
              { ar: "مثل زحل، يمتلك أورانوس نظام حلقات، على الرغم من أنها أغمق وأصعب في الرؤية.", en: "Like Saturn, Uranus has a ring system, although its rings are much darker and harder to see." },
              { ar: "لأورانوس 27 قمرًا معروفًا، تم تسمية معظمها على اسم شخصيات من أعمال ويليام شكسبير وألكسندر بوب.", en: "Uranus has 27 known moons, mostly named after characters from the works of William Shakespeare and Alexander Pope." }
           ]
         },
         {
           id: 8, name: { ar: "نبتون", en: "Neptune" },
           radius: 1.7, distance: 65, speed: 0.0003, tilt: 28.3, rotation: 0.065, texture: "https://threejs.org/examples/textures/planets/neptune.jpg", // Example texture
           info: {
             ar: "القطر: 49,244 كيلومتر\nالكتلة: 1.02 × 10²⁶ كيلوغرام\nالمدار: 164.8 سنة\nدرجة حرارة السطح (قمم السحب): -214°م\nأبعد كوكب عن الشمس",
             en: "Diameter: 49,244 km\nMass: 1.02 × 10²⁶ kg\nOrbit: 164.8 years\nCloud Top Temp: -214°C\nFarthest planet from the Sun",
           },
           fact: {
             ar: "نبتون هو الكوكب الوحيد الذي تم اكتشافه من خلال التنبؤ الرياضي بدلاً من الملاحظة المباشرة.",
             en: "Neptune is the only planet found by mathematical prediction rather than by direct observation."
           },
           extraFacts: [
              { ar: "يتميز نبتون بأسرع رياح في النظام الشمسي، تصل سرعتها إلى أكثر من 2000 كيلومتر في الساعة.", en: "Neptune has the fastest winds in the Solar System, reaching speeds over 2,000 km/h (1,200 mph)." },
              { ar: "البقعة المظلمة العظيمة، وهي عاصفة كبيرة مشابهة لبقعة المشتري الحمراء العظيمة، تمت ملاحظتها على نبتون بواسطة مسبار فوياجر 2 ولكنها اختفت لاحقًا.", en: "The Great Dark Spot, a large storm similar to Jupiter's Great Red Spot, was observed on Neptune by Voyager 2 but later disappeared." },
              { ar: "تريتون، أكبر أقمار نبتون، هو القمر الكبير الوحيد في النظام الشمسي الذي يدور في مدار تراجعي (عكس دوران الكوكب).", en: "Triton, Neptune's largest moon, is the only large moon in the Solar System with a retrograde orbit (orbiting opposite to the planet's rotation)." }
           ]
         }
      ];


      // --- DOM Elements ---
      const infoPanel = document.getElementById('infoPanel');
      const closeBtn = document.getElementById('closeBtn');
      const planetNameEl = document.getElementById('planetName');
      const planetInfoEl = document.getElementById('planetInfo');
      const planetFactEl = document.getElementById('planetFact');
      const readMoreBtn = document.getElementById('readMoreBtn');
      const extraFactsContainer = document.getElementById('extraFactsContainer');
      const planetsMenu = document.getElementById('planetsMenu');
      const planetsDropdown = document.getElementById('planetsDropdown');
      const langToggleBtn = document.getElementById('langToggleBtn');
      const speedDownBtn = document.getElementById('speedDownBtn'); // Speed Down Button
      const speedUpBtn = document.getElementById('speedUpBtn');     // Speed Up Button
      const speedDisplay = document.getElementById('speedDisplay'); // Speed Display Span

      // --- Initialization ---
      function init() {
        // Scene setup
        scene = new THREE.Scene();

        // Camera setup
        camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.z = 70; // Start further back
        camera.position.y = 20; // Elevated view

        // Renderer setup
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x333333); // Softer ambient
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 2, 300); // Brighter point light
        scene.add(pointLight);

        // Orbit Controls
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // Smooths movement
        controls.dampingFactor = 0.05;
        controls.screenSpacePanning = false; // Pan in plane of orbit
        controls.minDistance = 5; // Prevent zooming too close
        controls.maxDistance = 200; // Prevent zooming too far
        controls.maxPolarAngle = Math.PI / 2 - 0.05; // Prevent going below horizon

        // Texture Loader
        const textureLoader = new THREE.TextureLoader();

        // Create Planets
        planetsData.forEach((planetData) => {
          const geometry = new THREE.SphereGeometry(planetData.radius, 32, 32);
          const material = new THREE.MeshStandardMaterial({
            map: textureLoader.load(planetData.texture, undefined, undefined, () => {
                // Placeholder image on error - replace with a generic texture if needed
                console.error(`Failed to load texture: ${planetData.texture}`);
                // material.map = textureLoader.load('placeholder.jpg'); // Load a fallback texture
                material.color.set(0x888888); // Or set a fallback color
                material.needsUpdate = true;
            }),
            metalness: 0.1, // Slight metallic sheen
            roughness: 0.8, // Less glossy
          });

          // Make Sun emissive
          if (planetData.id === 0) {
            material.emissive.set(0xffff00); // Yellow glow
            material.emissiveIntensity = 1;
          }

          const mesh = new THREE.Mesh(geometry, material);
          mesh.position.x = planetData.distance;
          mesh.rotation.x = THREE.MathUtils.degToRad(planetData.tilt); // Apply tilt

          // Add an invisible click target slightly larger than the planet
          const clickTargetGeometry = new THREE.SphereGeometry(planetData.radius * 1.2, 8, 8); // Larger, less detail
          const clickTargetMaterial = new THREE.MeshBasicMaterial({ visible: false });
          const clickTarget = new THREE.Mesh(clickTargetGeometry, clickTargetMaterial);
          clickTarget.userData = { planetId: planetData.id }; // Store planet ID
          mesh.add(clickTarget); // Add target as child of planet mesh

          scene.add(mesh);
          planets.push({ mesh, angle: Math.random() * Math.PI * 2 }); // Store mesh and initial angle
        });

        // Create a simple Comet
        const cometGeometry = new THREE.ConeGeometry(0.3, 1, 8);
        const cometMaterial = new THREE.MeshBasicMaterial({ color: 0xaaaaff, transparent: true, opacity: 0.7 });
        comet = new THREE.Mesh(cometGeometry, cometMaterial);
        scene.add(comet);


        // Populate Planets Dropdown
        updatePlanetsDropdown();


        // Event Listeners
        window.addEventListener('resize', onWindowResize, false);
        closeBtn.addEventListener('click', hideInfoPanel);
        readMoreBtn.addEventListener('click', toggleExtraFacts);
        planetsMenu.addEventListener('click', toggleDropdown);
        langToggleBtn.addEventListener('click', toggleLanguage);
        speedDownBtn.addEventListener('click', decreaseSpeed); // Add listener
        speedUpBtn.addEventListener('click', increaseSpeed);   // Add listener


        // Click detection
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        function onMouseClick(event) {
            // Calculate mouse position in normalized device coordinates (-1 to +1)
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // Update the picking ray with the camera and mouse position
            raycaster.setFromCamera(mouse, camera);

            // Calculate objects intersecting the picking ray
            const intersects = raycaster.intersectObjects(scene.children, true); // Check descendants (includes click targets)

            let clickedPlanet = false;
            for (let i = 0; i < intersects.length; i++) {
                // Check if the intersected object is one of our invisible click targets
                if (intersects[i].object.userData.planetId !== undefined) {
                    const planetId = intersects[i].object.userData.planetId;
                    showInfoPanel(planetId);
                    focusOnPlanet(planetId);
                    clickedPlanet = true;
                    break; // Stop after finding the first planet
                }
            }

            // If clicked on empty space, stop following
            if (!clickedPlanet) {
                 isFollowingPlanet = false;
                 focusedPlanetIndex = -1;
                 controls.target.set(0, 0, 0); // Reset target to center
            }
        }
        window.addEventListener('click', onMouseClick, false);

        // Close dropdown if clicking outside
        document.addEventListener('click', (event) => {
            if (!planetsMenu.contains(event.target) && planetsDropdown.classList.contains('show')) {
                planetsDropdown.classList.remove('show');
            }
        });

      }

      // --- UI Update Functions ---

      function updateLanguageUI() {
          const newLang = currentLanguage === 'ar' ? 'en' : 'ar';
          document.body.setAttribute('dir', currentLanguage); // Set direction on body

          // Update menu text
          planetsMenu.firstChild.textContent = uiText.planetsMenu[currentLanguage] + ' '; // Add space before dropdown arrow if needed
          langToggleBtn.textContent = uiText.langToggle[currentLanguage];

          // Update info panel if visible
          if (currentlyDisplayedPlanetId !== null) {
              showInfoPanel(currentlyDisplayedPlanetId); // Re-render with new language
          } else {
              // Update button text even if panel is hidden
               readMoreBtn.textContent = uiText.readMore[currentLanguage];
          }

          // Update planets dropdown items
          updatePlanetsDropdown();
      }

      function updatePlanetsDropdown() {
          planetsDropdown.innerHTML = ''; // Clear existing items
          planetsData.forEach(planet => {
              const item = document.createElement('a');
              item.href = '#';
              item.classList.add('dropdown-item');
              item.textContent = planet.name[currentLanguage];
              item.onclick = (e) => {
                  e.preventDefault();
                  showInfoPanel(planet.id);
                  focusOnPlanet(planet.id);
                  planetsDropdown.classList.remove('show'); // Hide dropdown after selection
              };
              planetsDropdown.appendChild(item);
          });
      }


      function showInfoPanel(planetId) {
        const planetData = planetsData.find(p => p.id === planetId);
        if (!planetData) return;

        currentlyDisplayedPlanetId = planetId; // Store the ID

        planetNameEl.textContent = planetData.name[currentLanguage];
        // Replace newline characters with <br> for HTML display
        planetInfoEl.innerHTML = planetData.info[currentLanguage].replace(/\n/g, '<br>');
        planetFactEl.textContent = planetData.fact[currentLanguage];

        // Populate extra facts
        extraFactsContainer.innerHTML = ''; // Clear previous facts
        if (planetData.extraFacts && planetData.extraFacts.length > 0) {
            planetData.extraFacts.forEach(fact => {
                const p = document.createElement('p');
                p.textContent = fact[currentLanguage];
                extraFactsContainer.appendChild(p);
            });
            readMoreBtn.style.display = 'block'; // Show button if facts exist
            readMoreBtn.textContent = uiText.readMore[currentLanguage]; // Set button text
            extraFactsContainer.style.display = 'none'; // Ensure extra facts are hidden initially
        } else {
            readMoreBtn.style.display = 'none'; // Hide button if no extra facts
        }

        infoPanel.style.display = 'block';
      }

      function hideInfoPanel() {
        infoPanel.style.display = 'none';
        currentlyDisplayedPlanetId = null; // Clear the stored ID
        // Optionally reset follow state when closing panel
        // isFollowingPlanet = false;
        // focusedPlanetIndex = -1;
        // controls.target.set(0, 0, 0);
      }

       function toggleExtraFacts() {
           const isHidden = extraFactsContainer.style.display === 'none';
           extraFactsContainer.style.display = isHidden ? 'block' : 'none';
           // Optional: Change button text to "Hide Facts" when shown
           // readMoreBtn.textContent = isHidden ? (currentLanguage === 'ar' ? "إخفاء الحقائق" : "Hide Facts") : uiText.readMore[currentLanguage];
       }

       function toggleDropdown(event) {
           // Prevent document click listener from closing it immediately
           event.stopPropagation();
           planetsDropdown.classList.toggle('show');
       }

       function toggleLanguage() {
           currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
           updateLanguageUI();
       }

      // --- Speed Control Functions ---
      function updateSpeedDisplay() {
          speedDisplay.textContent = `${speeds[currentSpeedIndex]}x`;
          speedMultiplier = speeds[currentSpeedIndex];
      }

      function increaseSpeed() {
          currentSpeedIndex = (currentSpeedIndex + 1) % speeds.length; // Cycle forward
          updateSpeedDisplay();
      }

      function decreaseSpeed() {
          currentSpeedIndex = (currentSpeedIndex - 1 + speeds.length) % speeds.length; // Cycle backward
          updateSpeedDisplay();
      }


      // --- Camera and Interaction ---
       function focusOnPlanet(planetId) {
           const index = planetsData.findIndex(p => p.id === planetId);
           if (index !== -1) {
               isFollowingPlanet = true;
               focusedPlanetIndex = index;
               // Don't immediately jump the camera, let the animate loop handle lerping
           }
       }


      // --- Window Resize ---
      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      // --- Animation Loop ---
      function animate() {
        requestAnimationFrame(animate);

        // Animate Planets
        planets.forEach((p, index) => {
          const planetData = planetsData[index];
          const mesh = p.mesh;

          // Rotation around the planet's own axis (tilt adjusted)
          // Apply rotation based on speedMultiplier
          mesh.rotateOnAxis(new THREE.Vector3(0, 1, 0).applyQuaternion(mesh.quaternion), planetData.rotation * speedMultiplier);


          // Orbit around the Sun (center)
          if (planetData.distance > 0) {
            // Apply orbit speed based on speedMultiplier
            p.angle += planetData.speed * speedMultiplier * 0.5; // Adjusted speed application
            mesh.position.x = Math.cos(p.angle) * planetData.distance;
            mesh.position.z = Math.sin(p.angle) * planetData.distance;
          }

          // Follow camera logic
          if (isFollowingPlanet && index === focusedPlanetIndex) {
            const currentTargetPosition = mesh.position.clone();
            controls.target.lerp(currentTargetPosition, 0.05); // Smoothly move target

            // Calculate desired camera position relative to the planet
            const offsetDistance = planetData.radius * (planetData.id === 0 ? 5 : 8); // Adjust offset based on planet size
            // Maintain current camera direction relative to target
            const offset = camera.position.clone().sub(controls.target);
            offset.setLength(offsetDistance); // Keep the distance constant
            const desiredPosition = currentTargetPosition.clone().add(offset);

            camera.position.lerp(desiredPosition, 0.05); // Smoothly move camera
          }
        });

        // Animate Comet (apply speed multiplier here too if desired)
        const cometTime = Date.now() * 0.0002 * speedMultiplier; // Apply speed multiplier
        const cometSemiMajor = 80;
        const cometSemiMinor = 50;
        comet.position.x = Math.cos(cometTime) * cometSemiMajor;
        comet.position.z = Math.sin(cometTime) * cometSemiMinor;
        comet.position.y = Math.sin(cometTime * 0.7) * 15; // Keep Y movement independent or adjust as needed

        // Make comet point away from the sun (origin)
        const dirToSun = comet.position.clone().normalize().negate();
        // Calculate a stable up vector (e.g., world Y axis)
        const up = new THREE.Vector3(0, 1, 0);
        // Ensure the lookAt target is slightly ahead in the direction away from the sun
        const lookAtTarget = comet.position.clone().add(dirToSun);
        comet.lookAt(lookAtTarget);


        controls.update(); // Required if enableDamping is true
        renderer.render(scene, camera);
      }

      // --- Initial Setup ---
      init(); // Initialize Three.js, UI elements, and event listeners
      updateLanguageUI(); // Set initial language and UI text
      updateSpeedDisplay(); // Set initial speed display
      animate(); // Start the animation loop
    </script>
  </body>
</html>
