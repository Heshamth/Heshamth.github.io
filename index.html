<!DOCTYPE html>
 <html lang="en">
   <head>
     <meta charset="UTF-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0" />
     <title>FalakZoom</title>
     <link
       href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
       rel="stylesheet"
     />
     <link
       href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap"
       rel="stylesheet"
     />
     <style>
       body {
         margin: 0;
         overflow: hidden;
         background: black;
         font-family: "Poppins", "Cairo", Arial, sans-serif; /* Added Cairo */
       }

       #infoPanel {
         position: absolute;
         top: 70px;
         left: 20px;
         background: rgba(0, 0, 0, 0.88); /* Slightly more opaque */
         color: white;
         padding: 20px;
         border-radius: 10px;
         border: 1px solid rgba(255, 255, 255, 0.4);
         display: none;
         max-width: 400px; /* Slightly wider for more content */
         max-height: calc(100vh - 90px); /* Max height */
         overflow-y: auto; /* Allow scrolling if content exceeds height */
         font-size: 14px;
         line-height: 1.7;
         z-index: 50;
         box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
         scrollbar-width: thin; /* Firefox */
         scrollbar-color: rgba(255, 255, 255, 0.3) rgba(0, 0, 0, 0.5); /* Firefox */
       }
       /* Webkit scrollbar styles */
       #infoPanel::-webkit-scrollbar {
         width: 8px;
       }
       #infoPanel::-webkit-scrollbar-track {
         background: rgba(0, 0, 0, 0.5);
         border-radius: 10px;
       }
       #infoPanel::-webkit-scrollbar-thumb {
         background-color: rgba(255, 255, 255, 0.3);
         border-radius: 10px;
         border: 2px solid rgba(0, 0, 0, 0.5);
       }

       #infoPanel h2 {
         margin-top: 0;
         margin-bottom: 15px;
         font-size: 18px;
         font-weight: 600;
         border-bottom: 1px solid rgba(255, 255, 255, 0.3);
         padding-bottom: 8px;
       }

       #infoPanel p {
         margin-bottom: 10px;
       }

       #infoPanel .fact {
         font-style: italic;
         color: #cccccc;
         margin-top: 15px;
         padding-top: 10px;
         border-top: 1px dashed rgba(255, 255, 255, 0.2);
       }

       /* Read More Button Styles */
       #readMoreBtn {
         background-color: rgba(255, 255, 255, 0.15);
         color: #e0e0e0;
         border: 1px solid rgba(255, 255, 255, 0.3);
         padding: 8px 15px;
         border-radius: 5px;
         cursor: pointer;
         font-family: inherit;
         font-size: 13px;
         margin-top: 15px;
         transition: background-color 0.3s, color 0.3s;
         display: block; /* Make it block to take full width if needed */
         width: fit-content; /* Adjust width to content */
       }
       #readMoreBtn:hover {
         background-color: rgba(255, 255, 255, 0.25);
         color: white;
       }

       /* Extra Facts Container Styles */
       #extraFactsContainer {
         margin-top: 15px;
         padding-top: 15px;
         border-top: 1px solid rgba(255, 255, 255, 0.3);
       }
       #extraFactsContainer p {
         font-size: 13px; /* Slightly smaller */
         color: #bbbbbb; /* Slightly dimmer */
         margin-bottom: 8px;
         padding-left: 10px; /* Indent facts */
         position: relative;
       }
       /* Add bullet points visually */
       #extraFactsContainer p::before {
         content: "•";
         position: absolute;
         left: -2px; /* Adjust position based on language direction */
         top: 0;
         color: #66ccff; /* Accent color */
       }
       /* Adjust bullet for RTL */
       [dir="rtl"] #extraFactsContainer p {
         padding-left: 0;
         padding-right: 10px;
       }
       [dir="rtl"] #extraFactsContainer p::before {
         left: auto;
         right: -2px;
       }

       #closeBtn {
         position: absolute;
         top: 10px;
         right: 10px; /* Default to right */
         width: 28px;
         height: 28px;
         font-size: 16px;
         font-weight: bold;
         color: #ff6b6b;
         cursor: pointer;
         transition: transform 0.3s ease, color 0.3s ease,
           background 0.3s ease;
         padding: 0;
         background: rgba(255, 255, 255, 0.1);
         border: none;
         border-radius: 50%;
         display: flex;
         justify-content: center;
         align-items: center;
         z-index: 51; /* Ensure it's above content */
       }

       #closeBtn:hover {
         color: #ff4757;
         transform: scale(1.1) rotate(90deg);
         background: rgba(255, 255, 255, 0.2);
       }

       #menuBar {
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: 50px;
         background: rgba(0, 0, 0, 0.8);
         padding: 0 20px;
         box-sizing: border-box;
         display: flex;
         justify-content: space-between;
         align-items: center;
         z-index: 100;
         border-bottom: 1px solid rgba(255, 255, 255, 0.2);
       }

       .menu-controls {
         display: flex;
         align-items: center;
       }

       /* --- SHARED STYLES for menu items, lang button, and speed buttons --- */
       .menu-item,
       #langToggleBtn,
       .speed-btn { /* Added .speed-btn */
         position: relative;
         color: white;
         padding: 8px 15px; /* Consistent padding */
         margin-left: 10px; /* Consistent margin */
         cursor: pointer;
         font-family: "Poppins", "Cairo", sans-serif;
         border-radius: 4px; /* Consistent rounding */
         transition: background 0.3s ease, color 0.3s ease;
         font-size: 14px; /* Consistent font size */
         user-select: none;
         border: none; /* Ensure buttons have no border by default */
         background-color: transparent; /* Default transparent background */
       }

       .menu-item:hover,
       #langToggleBtn:hover,
       .speed-btn:hover { /* Added .speed-btn:hover */
         background: rgba(255, 255, 255, 0.2);
         color: #eee;
       }
       /* --- END SHARED STYLES --- */

        /* --- NEW SPEED CONTROL STYLES --- */
       #speedControlContainer {
         display: flex;
         align-items: center;
         margin-left: 10px; /* Add some space before language button */
         background-color: rgba(255, 255, 255, 0.1); /* Slight background for the group */
         border-radius: 4px; /* Match button rounding */
       }

       #speedDisplay {
         color: white;
         padding: 8px 10px; /* Adjust padding */
         font-size: 14px;
         font-family: "Poppins", "Cairo", sans-serif;
         user-select: none;
         min-width: 30px; /* Ensure minimum width */
         text-align: center;
       }

       /* Override margin for buttons inside the speed control */
       #speedControlContainer .speed-btn {
          margin-left: 0; /* Remove left margin for internal buttons */
       }
       /* --- END NEW SPEED CONTROL STYLES --- */


       .dropdown {
         position: absolute;
         top: 100%;
         background: rgba(25, 25, 25, 0.95);
         min-width: 180px;
         border-radius: 6px; /* Rounded all corners */
         overflow: hidden;
         display: none;
         box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
         border: 1px solid rgba(255, 255, 255, 0.1);
         z-index: 110;
       }

       /* LTR positioning for the dropdown */
       body[dir="ltr"] .menu-item .dropdown {
         right: 0;
         left: auto;
       }

       /* RTL positioning for the dropdown */
       body[dir="rtl"] .menu-item .dropdown {
         right: auto;
         left: 0;
       }

       .dropdown.show {
         display: block;
       }

       .dropdown-item {
         padding: 12px 20px;
         color: #e0e0e0;
         text-decoration: none;
         display: block;
         transition: background 0.2s ease, color 0.2s ease;
         font-size: 14px;
         white-space: nowrap;
       }

       .dropdown-item:hover {
         background: rgba(255, 255, 255, 0.15);
         color: white;
       }

       #title {
         color: white;
         font-family: "Poppins", sans-serif;
         font-size: 22px;
         font-weight: 600;
       }

       /* Language Direction Adjustments */
       body[dir="rtl"] #infoPanel {
         left: auto;
         right: 20px;
         text-align: right;
       }
       body[dir="ltr"] #infoPanel {
         left: 20px;
         right: auto;
         text-align: left;
       }
       body[dir="rtl"] #closeBtn {
         left: 10px;
         right: auto;
       }
       body[dir="ltr"] #closeBtn {
         left: auto;
         right: 10px;
       }
       body[dir="rtl"] #readMoreBtn {
         margin-right: auto; /* Align button left in RTL */
       }
       body[dir="ltr"] #readMoreBtn {
         margin-left: auto; /* Align button right in LTR */
       }
     </style>
   </head>
   <body>
     <div id="menuBar">
       <div id="title" data-translate="title">FalakZoom</div>
       <div class="menu-controls">
         <div class="menu-item" id="planetsMenu">
           <span data-translate="planets">Planets</span>
           <div class="dropdown" id="planetsDropdown">
             </div>
         </div>
          <div id="speedControlContainer">
             <button id="speedDownBtn" class="speed-btn">-</button>
             <span id="speedDisplay">1x</span>
             <button id="speedUpBtn" class="speed-btn">+</button>
         </div>
         <button id="langToggleBtn">AR/EN</button>
       </div>
     </div>

     <div id="infoPanel">
       <button id="closeBtn">✕</button>
       <h2 id="infoTitle"></h2>
       <p id="infoDesc"></p>
       <p id="infoDistance"></p>
       <p id="infoRadius"></p>
       <p id="infoOrbit"></p>
       <p id="infoRotation"></p>
       <p class="fact" id="infoFact"></p>

       <button id="readMoreBtn" data-translate="readMore">Read More</button>
        <div id="extraFactsContainer" style="display: none;"></div>
     </div>

     <script type="importmap">
       {
         "imports": {
           "three": "https://unpkg.com/three@0.159.0/build/three.module.js",
           "three/addons/": "https://unpkg.com/three@0.159.0/examples/jsm/"
         }
       }
     </script>
     <script type="module">
       import * as THREE from "three";
       import { OrbitControls } from "three/addons/controls/OrbitControls.js";
       import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";

       // --- Scene Setup ---
       const scene = new THREE.Scene();
       const camera = new THREE.PerspectiveCamera(
         75,
         window.innerWidth / window.innerHeight,
         0.1,
         1000
       );
       const renderer = new THREE.WebGLRenderer({ antialias: true });
       renderer.setSize(window.innerWidth, window.innerHeight);
       renderer.shadowMap.enabled = true; // Enable shadows
       document.body.appendChild(renderer.domElement);

       // --- Lighting ---
       const ambientLight = new THREE.AmbientLight(0xffffff, 0.4); // Soft ambient light
       scene.add(ambientLight);
       const pointLight = new THREE.PointLight(0xffffff, 300, 300); // Sun light
       pointLight.position.set(0, 0, 0);
       pointLight.castShadow = true; // Sun casts shadow
       scene.add(pointLight);

       // --- Controls ---
       const controls = new OrbitControls(camera, renderer.domElement);
       controls.enableDamping = true;
       controls.dampingFactor = 0.05;
       controls.screenSpacePanning = false;
       controls.minDistance = 1;
       controls.maxDistance = 500;

       // --- Stars ---
       const starGeometry = new THREE.BufferGeometry();
       const starMaterial = new THREE.PointsMaterial({
         color: 0xffffff,
         size: 0.05, // Smaller star size
         sizeAttenuation: true, // Stars shrink with distance
       });
       const starVertices = [];
       for (let i = 0; i < 15000; i++) { // Increased star count
         const x = (Math.random() - 0.5) * 2000;
         const y = (Math.random() - 0.5) * 2000;
         const z = (Math.random() - 0.5) * 2000;
         // Ensure stars are far away
         if (x*x + y*y + z*z > 100*100) {
            starVertices.push(x, y, z);
         }
       }
       starGeometry.setAttribute(
         "position",
         new THREE.Float32BufferAttribute(starVertices, 3)
       );
       const stars = new THREE.Points(starGeometry, starMaterial);
       scene.add(stars);

        // --- Comet ---
        // NOTE: Keeping original comet code BEFORE problematic tail implementation
        const cometGeometry = new THREE.SphereGeometry(0.3, 16, 16); // Smaller comet head
        const cometMaterial = new THREE.MeshStandardMaterial({
            color: 0xaaaaff, // Bluish white
            emissive: 0x8888ff, // Slight glow
            roughness: 0.8,
            metalness: 0.2
        });
        const comet = new THREE.Mesh(cometGeometry, cometMaterial);
        comet.castShadow = true; // Comet casts shadow
        scene.add(comet);


       // --- Language and Data ---
       // NOTE: Keeping original translations
       const translations = {
         en: {
             title: "FalakZoom",
             planets: "Planets",
             readMore: "Read More",
             sun: "Sun",
             mercury: "Mercury",
             venus: "Venus",
             earth: "Earth",
             mars: "Mars",
             jupiter: "Jupiter",
             saturn: "Saturn",
             uranus: "Uranus",
             neptune: "Neptune",
             distance_au: "Distance from Sun",
             radius_km: "Radius",
             orbit_days: "Orbit Period",
             rotation_hours: "Rotation Period",
             fact: "Fact",
             sun_desc: "The star at the center of our Solar System.",
             sun_dist: "0 AU",
             sun_rad: "696,340 km",
             sun_orb: "N/A (Center)",
             sun_rot: "~27 Earth days (equator)",
             sun_fact: "The Sun accounts for about 99.86% of the total mass of the Solar System.",
             sun_extra1: "Surface Temperature: ~5,500 °C.",
             sun_extra2: "Core Temperature: ~15 million °C.",
             sun_extra3: "Age: ~4.6 billion years.",
             mercury_desc: "The smallest planet and closest to the Sun.",
             mercury_dist: "0.4 AU",
             mercury_rad: "2,440 km",
             mercury_orb: "88 Earth days",
             mercury_rot: "1408 hours",
             mercury_fact: "Mercury has extreme temperature variations, from -173°C at night to 427°C during the day.",
             mercury_extra1: "No substantial atmosphere.",
             mercury_extra2: "Surface is heavily cratered.",
             mercury_extra3: "Has a large iron core.",
             venus_desc: "The second planet, known for its thick, toxic atmosphere.",
             venus_dist: "0.7 AU",
             venus_rad: "6,052 km",
             venus_orb: "225 Earth days",
             venus_rot: "5832 hours (Retrograde)",
             venus_fact: "Venus rotates backwards (retrograde) compared to most other planets.",
             venus_extra1: "Hottest planet due to runaway greenhouse effect.",
             venus_extra2: "Surface pressure is 92 times Earth's.",
             venus_extra3: "Covered in thick clouds of sulfuric acid.",
             earth_desc: "Our home planet, the only known place with liquid water and life.",
             earth_dist: "1 AU",
             earth_rad: "6,371 km",
             earth_orb: "365.25 days",
             earth_rot: "24 hours",
             earth_fact: "Earth is the densest planet in the Solar System.",
             earth_extra1: "Has one large natural satellite, the Moon.",
             earth_extra2: "Atmosphere is mostly nitrogen and oxygen.",
             earth_extra3: "Has active plate tectonics.",
             mars_desc: "The 'Red Planet', known for its iron oxide surface.",
             mars_dist: "1.5 AU",
             mars_rad: "3,390 km",
             mars_orb: "687 Earth days",
             mars_rot: "24.6 hours",
             mars_fact: "Mars has the largest volcano (Olympus Mons) and the deepest canyon (Valles Marineris) in the Solar System.",
             mars_extra1: "Thin atmosphere, mostly carbon dioxide.",
             mars_extra2: "Has polar ice caps made of water and CO2 ice.",
             mars_extra3: "Has two small moons: Phobos and Deimos.",
             jupiter_desc: "The largest planet, a gas giant with a Great Red Spot.",
             jupiter_dist: "5.2 AU",
             jupiter_rad: "69,911 km",
             jupiter_orb: "11.9 Earth years",
             jupiter_rot: "9.9 hours",
             jupiter_fact: "Jupiter's Great Red Spot is a giant storm larger than Earth that has raged for centuries.",
             jupiter_extra1: "Has a strong magnetic field.",
             jupiter_extra2: "Has dozens of moons, including the four large Galilean moons.",
             jupiter_extra3: "Composed mainly of hydrogen and helium.",
             saturn_desc: "Famous for its extensive and prominent ring system.",
             saturn_dist: "9.5 AU",
             saturn_rad: "58,232 km",
             saturn_orb: "29.5 Earth years",
             saturn_rot: "10.7 hours",
             saturn_fact: "Saturn's rings are made mostly of ice particles with a smaller amount of rocky debris and dust.",
             saturn_extra1: "Least dense planet; could float in water (if a large enough bathtub existed!).",
             saturn_extra2: "Has many moons, including Titan, the largest.",
             saturn_extra3: "Also primarily hydrogen and helium.",
             uranus_desc: "An ice giant tilted on its side.",
             uranus_dist: "19.2 AU",
             uranus_rad: "25,362 km",
             uranus_orb: "84 Earth years",
             uranus_rot: "17.2 hours (Retrograde)",
             uranus_fact: "Uranus rotates on its side, with its axis tilted almost 98 degrees.",
             uranus_extra1: "Blue-green color from methane in its atmosphere.",
             uranus_extra2: "Has faint rings and numerous moons.",
             uranus_extra3: "Classified as an 'ice giant' due to icy materials.",
             neptune_desc: "The farthest planet, a dark, cold ice giant.",
             neptune_dist: "30.1 AU",
             neptune_rad: "24,622 km",
             neptune_orb: "165 Earth years",
             neptune_rot: "16.1 hours",
             neptune_fact: "Neptune has the strongest winds in the Solar System, reaching up to 2,100 km/h.",
             neptune_extra1: "Deep blue color also due to methane.",
             neptune_extra2: "Has a Great Dark Spot (a storm, though less persistent than Jupiter's).",
             neptune_extra3: "Has several known moons, Triton being the largest."
         },
         ar: {
             title: "فلك زوم",
             planets: "الكواكب",
             readMore: "اقرأ المزيد",
             sun: "الشمس",
             mercury: "عطارد",
             venus: "الزهرة",
             earth: "الأرض",
             mars: "المريخ",
             jupiter: "المشتري",
             saturn: "زحل",
             uranus: "أورانوس",
             neptune: "نبتون",
             distance_au: "المسافة من الشمس",
             radius_km: "نصف القطر",
             orbit_days: "فترة المدار",
             rotation_hours: "فترة الدوران",
             fact: "حقيقة",
             sun_desc: "النجم في مركز نظامنا الشمسي.",
             sun_dist: "0 وحدة فلكية",
             sun_rad: "696,340 كم",
             sun_orb: "غير منطبق (المركز)",
             sun_rot: "~27 يومًا أرضيًا (خط الاستواء)",
             sun_fact: "تمثل الشمس حوالي 99.86٪ من إجمالي كتلة النظام الشمسي.",
             sun_extra1: "درجة حرارة السطح: ~ 5,500 درجة مئوية.",
             sun_extra2: "درجة حرارة اللب: ~ 15 مليون درجة مئوية.",
             sun_extra3: "العمر: ~ 4.6 مليار سنة.",
             mercury_desc: "أصغر كوكب وأقربها إلى الشمس.",
             mercury_dist: "0.4 وحدة فلكية",
             mercury_rad: "2,440 كم",
             mercury_orb: "88 يومًا أرضيًا",
             mercury_rot: "1408 ساعة",
             mercury_fact: "يعاني عطارد من تقلبات شديدة في درجات الحرارة، من -173 درجة مئوية ليلاً إلى 427 درجة مئوية نهارًا.",
             mercury_extra1: "لا يوجد غلاف جوي كبير.",
             mercury_extra2: "السطح مليء بالفوهات الصدمية.",
             mercury_extra3: "يمتلك نواة حديدية كبيرة.",
             venus_desc: "الكوكب الثاني، معروف بغلافه الجوي الكثيف السام.",
             venus_dist: "0.7 وحدة فلكية",
             venus_rad: "6,052 كم",
             venus_orb: "225 يومًا أرضيًا",
             venus_rot: "5832 ساعة (دوران تراجعي)",
             venus_fact: "يدور كوكب الزهرة للخلف (دوران تراجعي) مقارنة بمعظم الكواكب الأخرى.",
             venus_extra1: "أسخن كوكب بسبب تأثير الاحتباس الحراري الجامح.",
             venus_extra2: "الضغط السطحي يعادل 92 ضعف ضغط الأرض.",
             venus_extra3: "مغطى بسحب كثيفة من حمض الكبريتيك.",
             earth_desc: "كوكبنا الأم، المكان الوحيد المعروف بوجود الماء السائل والحياة.",
             earth_dist: "1 وحدة فلكية",
             earth_rad: "6,371 كم",
             earth_orb: "365.25 يومًا",
             earth_rot: "24 ساعة",
             earth_fact: "الأرض هي الكوكب الأكثر كثافة في النظام الشمسي.",
             earth_extra1: "له قمر طبيعي واحد كبير، القمر.",
             earth_extra2: "الغلاف الجوي يتكون معظمه من النيتروجين والأكسجين.",
             earth_extra3: "يحتوي على تكتونيات صفائح نشطة.",
             mars_desc: "الكوكب الأحمر، معروف بسطحه المكون من أكسيد الحديد.",
             mars_dist: "1.5 وحدة فلكية",
             mars_rad: "3,390 كم",
             mars_orb: "687 يومًا أرضيًا",
             mars_rot: "24.6 ساعة",
             mars_fact: "يحتوي المريخ على أكبر بركان (أوليمبوس مونس) وأعمق واد (فاليس مارينريس) في النظام الشمسي.",
             mars_extra1: "غلاف جوي رقيق، معظمه ثاني أكسيد الكربون.",
             mars_extra2: "يحتوي على أغطية جليدية قطبية مصنوعة من الماء وجليد ثاني أكسيد الكربون.",
             mars_extra3: "له قمران صغيران: فوبوس وديموس.",
             jupiter_desc: "أكبر كوكب، عملاق غازي به بقعة حمراء عظيمة.",
             jupiter_dist: "5.2 وحدة فلكية",
             jupiter_rad: "69,911 كم",
             jupiter_orb: "11.9 سنة أرضية",
             jupiter_rot: "9.9 ساعة",
             jupiter_fact: "البقعة الحمراء العظيمة للمشتري هي عاصفة عملاقة أكبر من الأرض مستعرة منذ قرون.",
             jupiter_extra1: "له مجال مغناطيسي قوي.",
             jupiter_extra2: "له عشرات الأقمار، بما في ذلك أقمار غاليليو الأربعة الكبيرة.",
             jupiter_extra3: "يتكون بشكل أساسي من الهيدروجين والهيليوم.",
             saturn_desc: "يشتهر بنظام حلقاته الواسع والبارز.",
             saturn_dist: "9.5 وحدة فلكية",
             saturn_rad: "58,232 كم",
             saturn_orb: "29.5 سنة أرضية",
             saturn_rot: "10.7 ساعة",
             saturn_fact: "تتكون حلقات زحل في الغالب من جزيئات الجليد مع كمية أقل من الحطام الصخري والغبار.",
             saturn_extra1: "أقل الكواكب كثافة؛ يمكن أن يطفو في الماء (إذا وجد حوض استحمام كبير بما يكفي!).",
             saturn_extra2: "له العديد من الأقمار، بما في ذلك تيتان، الأكبر.",
             saturn_extra3: "يتكون أيضًا بشكل أساسي من الهيدروجين والهيليوم.",
             uranus_desc: "عملاق جليدي يميل على جانبه.",
             uranus_dist: "19.2 وحدة فلكية",
             uranus_rad: "25,362 كم",
             uranus_orb: "84 سنة أرضية",
             uranus_rot: "17.2 ساعة (دوران تراجعي)",
             uranus_fact: "يدور أورانوس على جانبه، حيث يميل محوره حوالي 98 درجة.",
             uranus_extra1: "لون أزرق مخضر من الميثان في غلافه الجوي.",
             uranus_extra2: "له حلقات باهتة والعديد من الأقمار.",
             uranus_extra3: "يصنف على أنه 'عملاق جليدي' بسبب المواد الجليدية.",
             neptune_desc: "أبعد كوكب، عملاق جليدي مظلم وبارد.",
             neptune_dist: "30.1 وحدة فلكية",
             neptune_rad: "24,622 كم",
             neptune_orb: "165 سنة أرضية",
             neptune_rot: "16.1 ساعة",
             neptune_fact: "يمتلك نبتون أقوى رياح في النظام الشمسي، تصل سرعتها إلى 2100 كم / ساعة.",
             neptune_extra1: "لون أزرق غامق أيضًا بسبب الميثان.",
             neptune_extra2: "له بقعة مظلمة كبيرة (عاصفة، وإن كانت أقل استمرارًا من بقعة المشتري).",
             neptune_extra3: "له العديد من الأقمار المعروفة، تريتون هو الأكبر."
           }
       };

       let currentLang = "en"; // Default language

       // NOTE: Keeping original planet data structure
       const planetData = [
           { id: 0, name: 'sun', radius: 2, distance: 0, speed: 0, color: 0xffff00, emissive: 0xffff00, texture: 'textures/sun.jpg', modelPath: null, description_key: 'sun_desc', dist_key: 'sun_dist', rad_key: 'sun_rad', orb_key: 'sun_orb', rot_key: 'sun_rot', fact_key: 'sun_fact', extra_keys: ['sun_extra1', 'sun_extra2', 'sun_extra3'] },
           { id: 1, name: 'mercury', radius: 0.3, distance: 6, speed: 0.01, color: 0xaaaaaa, texture: 'textures/mercury.jpg', modelPath: null, description_key: 'mercury_desc', dist_key: 'mercury_dist', rad_key: 'mercury_rad', orb_key: 'mercury_orb', rot_key: 'mercury_rot', fact_key: 'mercury_fact', extra_keys: ['mercury_extra1', 'mercury_extra2', 'mercury_extra3'] },
           { id: 2, name: 'venus', radius: 0.6, distance: 10, speed: 0.007, color: 0xffe4b5, texture: 'textures/venus.jpg', modelPath: null, description_key: 'venus_desc', dist_key: 'venus_dist', rad_key: 'venus_rad', orb_key: 'venus_orb', rot_key: 'venus_rot', fact_key: 'venus_fact', extra_keys: ['venus_extra1', 'venus_extra2', 'venus_extra3'] },
           { id: 3, name: 'earth', radius: 0.65, distance: 15, speed: 0.005, color: 0x0077ff, texture: 'textures/earth.jpg', modelPath: null, description_key: 'earth_desc', dist_key: 'earth_dist', rad_key: 'earth_rad', orb_key: 'earth_orb', rot_key: 'earth_rot', fact_key: 'earth_fact', extra_keys: ['earth_extra1', 'earth_extra2', 'earth_extra3'] },
           { id: 4, name: 'mars', radius: 0.4, distance: 22, speed: 0.004, color: 0xff5733, texture: 'textures/mars.jpg', modelPath: null, description_key: 'mars_desc', dist_key: 'mars_dist', rad_key: 'mars_rad', orb_key: 'mars_orb', rot_key: 'mars_rot', fact_key: 'mars_fact', extra_keys: ['mars_extra1', 'mars_extra2', 'mars_extra3'] },
           { id: 5, name: 'jupiter', radius: 1.5, distance: 35, speed: 0.002, color: 0xffd700, texture: 'textures/jupiter.jpg', modelPath: null, description_key: 'jupiter_desc', dist_key: 'jupiter_dist', rad_key: 'jupiter_rad', orb_key: 'jupiter_orb', rot_key: 'jupiter_rot', fact_key: 'jupiter_fact', extra_keys: ['jupiter_extra1', 'jupiter_extra2', 'jupiter_extra3'] },
           { id: 6, name: 'saturn', radius: 1.3, distance: 50, speed: 0.0015, color: 0xf0e68c, texture: 'textures/saturn.jpg', modelPath: 'models/saturn_with_rings.glb', description_key: 'saturn_desc', dist_key: 'saturn_dist', rad_key: 'saturn_rad', orb_key: 'saturn_orb', rot_key: 'saturn_rot', fact_key: 'saturn_fact', extra_keys: ['saturn_extra1', 'saturn_extra2', 'saturn_extra3'] },
           { id: 7, name: 'uranus', radius: 1.0, distance: 65, speed: 0.001, color: 0xadd8e6, texture: 'textures/uranus.jpg', modelPath: null, description_key: 'uranus_desc', dist_key: 'uranus_dist', rad_key: 'uranus_rad', orb_key: 'uranus_orb', rot_key: 'uranus_rot', fact_key: 'uranus_fact', extra_keys: ['uranus_extra1', 'uranus_extra2', 'uranus_extra3'] },
           { id: 8, name: 'neptune', radius: 0.95, distance: 80, speed: 0.0008, color: 0x0000ff, texture: 'textures/neptune.jpg', modelPath: null, description_key: 'neptune_desc', dist_key: 'neptune_dist', rad_key: 'neptune_rad', orb_key: 'neptune_orb', rot_key: 'neptune_rot', fact_key: 'neptune_fact', extra_keys: ['neptune_extra1', 'neptune_extra2', 'neptune_extra3'] },
       ];

       const planets = []; // Array to hold planet meshes/groups
       const textureLoader = new THREE.TextureLoader();
       const modelLoader = new GLTFLoader();

       // --- Create Planets ---
       // NOTE: Keeping original planet creation logic
       planetData.forEach((p, index) => {
         let planetMesh;

         if (p.modelPath) {
           // Load GLB model
           modelLoader.load(p.modelPath, (gltf) => {
             planetMesh = gltf.scene;
             planetMesh.scale.set(p.radius, p.radius, p.radius); // Scale the loaded model
             planetMesh.traverse( function ( child ) {
                 if ( child.isMesh ) {
                     child.castShadow = true;
                     child.receiveShadow = true;
                 }
             } );
             scene.add(planetMesh);
             planets[index] = { mesh: planetMesh, data: p, angle: Math.random() * Math.PI * 2 };
             // setupPlanetInteraction(planetMesh, p, index); // Setup interaction AFTER loading
             // Store original scale for hover effect
             planetMesh.userData.originalScale = planetMesh.scale.clone();
           }, undefined, (error) => {
              console.error(`Error loading model ${p.modelPath}:`, error); // Add error logging
           });
         } else {
           // Create sphere geometry
           const geometry = new THREE.SphereGeometry(p.radius, 32, 32);
           const material = new THREE.MeshStandardMaterial({
               map: textureLoader.load(p.texture),
               emissive: p.emissive ? p.color : 0x000000, // Only sun emits light
               emissiveIntensity: p.emissive ? 0.8 : 0,
               roughness: 0.8,
               metalness: 0.2,
           });
           planetMesh = new THREE.Mesh(geometry, material);
           planetMesh.castShadow = true; // Planets cast shadows
           planetMesh.receiveShadow = true; // Planets receive shadows
           scene.add(planetMesh);
           planets[index] = { mesh: planetMesh, data: p, angle: Math.random() * Math.PI * 2 };
           // setupPlanetInteraction(planetMesh, p, index); // Setup interaction for spheres
            // Store original scale for hover effect
           planetMesh.userData.originalScale = planetMesh.scale.clone();
         }

         // Add orbit lines (optional) - Keeping original
         if(p.distance > 0){ // Don't draw orbit for the sun
             const orbitGeometry = new THREE.RingGeometry(p.distance - 0.1, p.distance + 0.1, 128);
             const orbitMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, opacity: 0.1, transparent: true });
             const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
             orbit.rotation.x = -Math.PI / 2; // Rotate to be flat on XZ plane
             scene.add(orbit);
         }
       });

       // --- Raycasting for Interaction ---
       // NOTE: Keeping original raycasting logic
       const raycaster = new THREE.Raycaster();
       const mouse = new THREE.Vector2();
       let intersectedObject = null;
       let isFollowingPlanet = false;
       let focusedPlanetIndex = -1;

       function onMouseMove(event) {
           mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
           mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

           if (infoPanel.style.display === 'block' || planetsDropdown.classList.contains('show')) {
               if (intersectedObject) {
                   intersectedObject.scale.copy(intersectedObject.userData.originalScale); // Revert scale
                   intersectedObject = null;
                   document.body.style.cursor = 'auto';
               }
               return;
           }

           raycaster.setFromCamera(mouse, camera);
           const meshesToCheck = planets.map(p => p.mesh).filter(m => m); // Filter out potentially unloaded models
           const intersects = raycaster.intersectObjects(meshesToCheck, true); // Check children for models

           if (intersects.length > 0) {
               let targetMesh = intersects[0].object;
                while(targetMesh.parent && targetMesh.parent !== scene){
                    // Check if the parent is one of the main planet meshes/groups we stored
                   if (planets.some(p => p.mesh === targetMesh.parent)){
                       targetMesh = targetMesh.parent;
                       break;
                   }
                   targetMesh = targetMesh.parent;
               }

               if (intersectedObject !== targetMesh) {
                   if (intersectedObject) {
                       intersectedObject.scale.copy(intersectedObject.userData.originalScale); // Revert scale
                   }
                   intersectedObject = targetMesh;
                   // Apply hover scale relative to original scale
                   intersectedObject.scale.copy(intersectedObject.userData.originalScale).multiplyScalar(1.2);
                   document.body.style.cursor = 'pointer';
               }
           } else {
               if (intersectedObject) {
                   intersectedObject.scale.copy(intersectedObject.userData.originalScale); // Revert scale
                   intersectedObject = null;
                   document.body.style.cursor = 'auto';
               }
           }
       }

       function onMouseClick(event) {
         if (intersectedObject) {
             const clickedPlanet = planets.find(p => p.mesh === intersectedObject);
             if (clickedPlanet) {
                 showInfoPanel(clickedPlanet.data);
                 focusedPlanetIndex = planets.indexOf(clickedPlanet);
                 isFollowingPlanet = (clickedPlanet.data.id !== 0); // Don't follow sun
             }
         } else {
             const isClickInsidePanel = infoPanel.contains(event.target);
             const isClickOnCloseButton = event.target === closeBtn;
             const isClickInsideDropdown = planetsDropdown.contains(event.target);
             const isClickOnMenu = planetsMenu.contains(event.target);
             const isClickOnSpeedControl = speedControlContainer.contains(event.target); // Check speed control

             // Hide info panel
             if (!isClickInsidePanel && infoPanel.style.display === 'block' && !isClickOnCloseButton && !isClickOnMenu && !isClickInsideDropdown && !isClickOnSpeedControl) {
                  hideInfoPanel();
             }
             // Hide dropdown
             if (!isClickOnMenu && !isClickInsideDropdown && planetsDropdown.classList.contains('show')) {
                  planetsDropdown.classList.remove('show');
             }
         }
       }

       // --- Info Panel Logic ---
       // NOTE: Keeping original info panel logic
       const infoPanel = document.getElementById("infoPanel");
       const infoTitle = document.getElementById("infoTitle");
       const infoDesc = document.getElementById("infoDesc");
       const infoDistance = document.getElementById("infoDistance");
       const infoRadius = document.getElementById("infoRadius");
       const infoOrbit = document.getElementById("infoOrbit");
       const infoRotation = document.getElementById("infoRotation");
       const infoFact = document.getElementById("infoFact");
       const closeBtn = document.getElementById("closeBtn");
       const readMoreBtn = document.getElementById("readMoreBtn");
       const extraFactsContainer = document.getElementById("extraFactsContainer");


       function showInfoPanel(data) {
           const langData = translations[currentLang];
           infoTitle.textContent = langData[data.name];
           infoDesc.textContent = langData[data.description_key];
           infoDistance.textContent = `${langData.distance_au}: ${langData[data.dist_key]}`;
           infoRadius.textContent = `${langData.radius_km}: ${langData[data.rad_key]}`;
           infoOrbit.textContent = `${langData.orbit_days}: ${langData[data.orb_key]}`;
           infoRotation.textContent = `${langData.rotation_hours}: ${langData[data.rot_key]}`;
           infoFact.textContent = `${langData.fact}: ${langData[data.fact_key]}`;

            extraFactsContainer.innerHTML = '';
            if (data.extra_keys && data.extra_keys.length > 0) {
                data.extra_keys.forEach(key => {
                    if (langData[key]) {
                        const p = document.createElement('p');
                        p.textContent = langData[key];
                        extraFactsContainer.appendChild(p);
                    }
                });
                readMoreBtn.style.display = 'block';
                extraFactsContainer.style.display = 'none';
            } else {
                readMoreBtn.style.display = 'none';
                extraFactsContainer.style.display = 'none';
            }

           infoPanel.style.display = "block";
           if (intersectedObject) {
             intersectedObject.scale.copy(intersectedObject.userData.originalScale); // Revert scale
             intersectedObject = null;
             document.body.style.cursor = 'auto';
           }
       }

       function hideInfoPanel() {
         infoPanel.style.display = "none";
         isFollowingPlanet = false;
         focusedPlanetIndex = -1;
         controls.target.set(0, 0, 0); // Reset target to origin
       }

       closeBtn.addEventListener("click", hideInfoPanel);
       readMoreBtn.addEventListener("click", () => {
            extraFactsContainer.style.display = extraFactsContainer.style.display === 'none' ? 'block' : 'none';
            // Basic toggle text (ensure translation exists or fallback)
            const readMoreKey = translations[currentLang].readMore || 'Read More';
            const showLessKey = translations[currentLang].showLess || 'Show Less'; // Add a showLess key if desired
            readMoreBtn.textContent = extraFactsContainer.style.display === 'none' ? readMoreKey : showLessKey;
       });


       // --- Menu Bar Logic ---
       // NOTE: Keeping original menu logic + Adding speed control container reference
       const planetsMenu = document.getElementById("planetsMenu");
       const planetsDropdown = document.getElementById("planetsDropdown");
       const langToggleBtn = document.getElementById("langToggleBtn");
       const speedControlContainer = document.getElementById("speedControlContainer"); // Added reference


       function populateDropdown() {
            planetsDropdown.innerHTML = '';
            const langData = translations[currentLang];
            planetData.forEach((p, index) => {
                const item = document.createElement("a");
                item.classList.add("dropdown-item");
                item.href = "#";
                item.textContent = langData[p.name];
                item.addEventListener("click", (e) => {
                  e.preventDefault();
                  // Ensure mesh exists before showing info/following
                  if (planets[index] && planets[index].mesh) {
                     showInfoPanel(p);
                     focusedPlanetIndex = index;
                     isFollowingPlanet = (p.id !== 0); // Don't follow sun
                     planetsDropdown.classList.remove("show");
                  } else {
                      console.warn(`Mesh for planet ${p.name} not ready.`); // Warn if model not loaded
                  }
                });
                planetsDropdown.appendChild(item);
            });
       }

       planetsMenu.addEventListener("click", (event) => {
         event.stopPropagation();
         planetsDropdown.classList.toggle("show");
       });

       window.addEventListener('click', (event) => {
           // Close dropdown if clicking outside the menu item
            if (!planetsMenu.contains(event.target) && planetsDropdown.classList.contains('show')) {
                planetsDropdown.classList.remove('show');
            }
       });


        // --- Language Toggle ---
        // NOTE: Keeping original language toggle logic
        function updateLanguageUI() {
            currentLang = document.documentElement.lang === 'ar' ? 'ar' : 'en';
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll("[data-translate]").forEach(el => {
                const key = el.getAttribute("data-translate");
                if (translations[currentLang][key]) {
                    el.textContent = translations[currentLang][key];
                }
            });
            populateDropdown();

             if (infoPanel.style.display === 'block' && focusedPlanetIndex !== -1) {
                  if (planetData[focusedPlanetIndex]){ // Ensure data exists
                    showInfoPanel(planetData[focusedPlanetIndex]);
                  }
             }
             // Update Read More button text if panel is open
            if (extraFactsContainer.style.display !== 'none') {
                 const showLessKey = translations[currentLang].showLess || 'Show Less';
                 readMoreBtn.textContent = showLessKey;
            } else if (infoPanel.style.display === 'block') {
                 const readMoreKey = translations[currentLang].readMore || 'Read More';
                 readMoreBtn.textContent = readMoreKey;
            }
        }


        langToggleBtn.addEventListener('click', () => {
            const newLang = document.documentElement.lang === 'en' ? 'ar' : 'en';
            document.documentElement.lang = newLang;
            updateLanguageUI();
        });

       // --- NEW SPEED CONTROL LOGIC ---
       const speedDownBtn = document.getElementById('speedDownBtn');
       const speedUpBtn = document.getElementById('speedUpBtn');
       const speedDisplay = document.getElementById('speedDisplay');
       const speedLevels = [0.25, 0.5, 1, 2, 4, 8]; // Using original requested levels
       let currentSpeedIndex = speedLevels.indexOf(1); // Start at 1x speed
       let simulationSpeed = speedLevels[currentSpeedIndex];

       function updateSpeedDisplay() {
            simulationSpeed = speedLevels[currentSpeedIndex];
            speedDisplay.textContent = `${simulationSpeed}x`;
            speedDownBtn.disabled = currentSpeedIndex === 0;
            speedUpBtn.disabled = currentSpeedIndex === speedLevels.length - 1;
            speedDownBtn.style.opacity = speedDownBtn.disabled ? 0.5 : 1;
            speedUpBtn.style.opacity = speedUpBtn.disabled ? 0.5 : 1;
            speedDownBtn.style.cursor = speedDownBtn.disabled ? 'not-allowed' : 'pointer';
            speedUpBtn.style.cursor = speedUpBtn.disabled ? 'not-allowed' : 'pointer';
       }

       speedDownBtn.addEventListener('click', () => {
           if (currentSpeedIndex > 0) {
               currentSpeedIndex--;
               updateSpeedDisplay();
           }
       });

       speedUpBtn.addEventListener('click', () => {
           if (currentSpeedIndex < speedLevels.length - 1) {
               currentSpeedIndex++;
               updateSpeedDisplay();
           }
       });
       // --- END NEW SPEED CONTROL LOGIC ---


       // --- Animation Loop ---
       // NOTE: Keeping mostly original animation loop, only adding simulationSpeed multiplier
       function animate() {
         requestAnimationFrame(animate);

         planets.forEach((p, index) => {
           const { mesh, data } = p;
           if (!mesh) return; // Skip if model not loaded yet

           mesh.rotation.y += 0.001; // Simple rotation

           // Orbital movement - ADDED simulationSpeed
           if (data.distance > 0) {
             p.angle += data.speed * 0.5 * simulationSpeed; // ONLY CHANGE HERE for planets
             mesh.position.x = Math.cos(p.angle) * data.distance;
             mesh.position.z = Math.sin(p.angle) * data.distance;
           }

           // Camera follow logic - Kept original
           if (isFollowingPlanet && index === focusedPlanetIndex) {
             const currentTargetPosition = mesh.position.clone();
             controls.target.copy(currentTargetPosition);

             const offsetDistance = (mesh.userData.originalScale.x || data.radius) * (data.id === 0 ? 5 : 8); // Use original scale or data radius for offset
             // Original simple offset calculation (may need refinement for better angles)
             const offset = new THREE.Vector3(0, offsetDistance * 0.5 , offsetDistance); // Offset slightly up and back
             const desiredPosition = currentTargetPosition.clone().add(offset);

             // Simpler camera follow - place camera directly for now if lerp is issue
             // camera.position.copy(desiredPosition); // Direct positioning
             camera.position.lerp(desiredPosition, 0.05); // Smoothly move camera (original)
             camera.lookAt(currentTargetPosition); // Ensure camera looks at target
           }
         });


        // Comet Animation - ADDED simulationSpeed
        const cometTime = Date.now() * 0.0002 * simulationSpeed; // ONLY CHANGE HERE for comet
        const cometSemiMajor = 80;
        const cometSemiMinor = 50;
        comet.position.x = Math.cos(cometTime) * cometSemiMajor;
        comet.position.z = Math.sin(cometTime) * cometSemiMinor;
        comet.position.y = Math.sin(cometTime * 0.7) * 15; // Independent Y oscillation
        // Original comet lookAt
        const dirToSun = comet.position.clone().normalize().negate();
        comet.lookAt(comet.position.clone().add(dirToSun));


         controls.update(); // Required if enableDamping is true
         renderer.render(scene, camera);
       }

       // --- Initial Setup ---
       updateLanguageUI();
       updateSpeedDisplay(); // Initialize speed display
       animate();

       // --- Resize Listener ---
       // NOTE: Keeping original resize listener
       window.addEventListener("resize", () => {
         camera.aspect = window.innerWidth / window.innerHeight;
         camera.updateProjectionMatrix();
         renderer.setSize(window.innerWidth, window.innerHeight);
       });

       // Set initial camera position
       camera.position.z = 30;
       camera.position.y = 15;
       camera.lookAt(0, 0, 0);

     </script>
   </body>
 </html>
