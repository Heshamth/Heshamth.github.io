<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FalakZoom</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
         overflow: hidden;
        background: black;
        font-family: "Poppins", "Cairo", Arial, sans-serif; /* Added Cairo */
       }

      #infoPanel {
        position: absolute;
         top: 70px;
        left: 20px;
        background: rgba(0, 0, 0, 0.88); /* Slightly more opaque */
        color: white;
         padding: 20px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        display: none;
        max-width: 400px;
 /* Slightly wider for more content */
        max-height: calc(100vh - 90px);
 /* Max height */
        overflow-y: auto;
 /* Allow scrolling if content exceeds height */
        font-size: 14px;
        line-height: 1.7;
         z-index: 50;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        scrollbar-width: thin;
 /* Firefox */
        scrollbar-color: rgba(255, 255, 255, 0.3) rgba(0, 0, 0, 0.5);
 /* Firefox */
      }
       /* Webkit scrollbar styles */
      #infoPanel::-webkit-scrollbar {
        width: 8px;
       }
      #infoPanel::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.5);
         border-radius: 10px;
      }
       #infoPanel::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
         border-radius: 10px;
        border: 2px solid rgba(0, 0, 0, 0.5);
      }


      #infoPanel h2 {
          margin-top: 0;
           margin-bottom: 15px;
          font-size: 18px;
          font-weight: 600;
          border-bottom: 1px solid rgba(255, 255, 255, 0.3);
          padding-bottom: 8px;
       }

      #infoPanel p {
          margin-bottom: 10px;
       }

       #infoPanel .fact {
           font-style: italic;
            color: #cccccc;
           margin-top: 15px;
           padding-top: 10px;
           border-top: 1px dashed rgba(255, 255, 255, 0.2);
        }

       /* Read More Button Styles */
       #readMoreBtn {
           background-color: rgba(255, 255, 255, 0.15);
            color: #e0e0e0;
           border: 1px solid rgba(255, 255, 255, 0.3);
           padding: 8px 15px;
           border-radius: 5px;
           cursor: pointer;
           font-family: inherit;
           font-size: 13px;
            margin-top: 15px;
           transition: background-color 0.3s, color 0.3s;
           display: block; /* Make it block to take full width if needed */
           width: fit-content;
 /* Adjust width to content */
       }
        #readMoreBtn:hover {
            background-color: rgba(255, 255, 255, 0.25);
             color: white;
        }

       /* Extra Facts Container Styles */
       #extraFactsContainer {
           margin-top: 15px;
            padding-top: 15px;
           border-top: 1px solid rgba(255, 255, 255, 0.3);
       }
        #extraFactsContainer p {
            font-size: 13px;
 /* Slightly smaller */
            color: #bbbbbb;
 /* Slightly dimmer */
            margin-bottom: 8px;
            padding-left: 10px;
 /* Indent facts */
            position: relative;
       }
         /* Add bullet points visually */
         #extraFactsContainer p::before {
            content: '•';
             position: absolute;
            left: -2px; /* Adjust position based on language direction */
            top: 0;
             color: #66ccff; /* Accent color */
         }
          /* Adjust bullet for RTL */
          [dir="rtl"] #extraFactsContainer p {
            padding-left: 0;
             padding-right: 10px;
          }
          [dir="rtl"] #extraFactsContainer p::before {
             left: auto;
              right: -2px;
          }


      #closeBtn {
        position: absolute;
         top: 10px;
        right: 10px; /* Default to right */
        width: 28px;
        height: 28px;
         font-size: 16px;
        font-weight: bold;
        color: #ff6b6b;
        cursor: pointer;
        transition: transform 0.3s ease, color 0.3s ease,
          background 0.3s ease;
         padding: 0;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 51;
 /* Ensure it's above content */
      }

      #closeBtn:hover {
        color: #ff4757;
         transform: scale(1.1) rotate(90deg);
        background: rgba(255, 255, 255, 0.2);
      }

      #menuBar {
        position: absolute;
         top: 0;
        left: 0;
        width: 100%;
        height: 50px;
        background: rgba(0, 0, 0, 0.8);
        padding: 0 20px;
        box-sizing: border-box;
        display: flex;
         justify-content: space-between;
        align-items: center;
        z-index: 100;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
       }

      .menu-controls {
          display: flex;
           align-items: center;
           gap: 15px; /* Add some space between controls */
      }

      .menu-item, #langToggleBtn {
        position: relative;
         color: white;
        padding: 8px 15px;
        /* margin-left: 10px; REMOVED - using gap now */
        cursor: pointer;
        font-family: "Poppins", "Cairo", sans-serif;
        border-radius: 4px;
         transition: background 0.3s ease, color 0.3s ease;
        font-size: 14px;
        user-select: none;
       }

      .menu-item:hover, #langToggleBtn:hover {
        background: rgba(255, 255, 255, 0.2);
         color: #eee;
      }

      /* UPDATED DROPDOWN STYLE */
      .dropdown {
        position: absolute;
        top: 100%;
        /* REMOVED right: 0; - will be handled by LTR/RTL rules below */
        background: rgba(25, 25, 25, 0.95);
        min-width: 180px;
        /* CHANGED border-radius to apply to all corners */
        border-radius: 6px;
        overflow: hidden;
        display: none;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        /* REMOVED border-top: none; */
        z-index: 110;
      }

       /* ADDED LTR/RTL positioning rules */
       /* Default LTR positioning for the dropdown */
       body[dir="ltr"] .menu-item .dropdown {
           right: 0;
           left: auto;
           /* Optional: If you want sharp top corners touching the menu item in LTR */
           /* border-top-left-radius: 0; */
           /* border-top-right-radius: 0; */
       }

       /* Added RTL positioning for the dropdown */
       body[dir="rtl"] .menu-item .dropdown {
           right: auto; /* Override default */
           left: 0;    /* Position from left */
           /* Optional: If you want sharp top corners touching the menu item in RTL */
           /* border-top-left-radius: 0; */
           /* border-top-right-radius: 0; */
       }

      .dropdown.show {
        display: block;
       }

      .dropdown-item {
        padding: 12px 20px;
        color: #e0e0e0;
         text-decoration: none;
        display: block;
        transition: background 0.2s ease, color 0.2s ease;
        font-size: 14px;
        white-space: nowrap;
       }

      .dropdown-item:hover {
        background: rgba(255, 255, 255, 0.15);
         color: white;
      }

      #title {
        color: white;
         font-family: "Poppins", sans-serif;
        font-size: 22px;
        font-weight: 600;
      }

       /* Language Direction Adjustments */
       body[dir="rtl"] #infoPanel {
            left: auto;
             right: 20px;
            text-align: right;
       }
       body[dir="ltr"] #infoPanel {
            left: 20px;
             right: auto;
            text-align: left;
       }
       body[dir="rtl"] #closeBtn {
            left: 10px;
             right: auto;
       }
       body[dir="ltr"] #closeBtn {
            left: auto;
             right: 10px;
       }
        body[dir="rtl"] #readMoreBtn {
            margin-right: auto;
 /* Align button left in RTL */
        }
        body[dir="ltr"] #readMoreBtn {
            margin-left: auto;
 /* Align button right in LTR */
        }

       /* --- Speed Slider Styles --- */
       #speedControlContainer {
            display: flex;
            align-items: center;
            color: white;
            font-size: 13px;
       }

       #speedSlider {
            width: 120px; /* Adjust width as needed */
            height: 5px; /* Slider track height */
            cursor: pointer;
            appearance: none; /* Override default look */
            background: rgba(255, 255, 255, 0.3); /* Track color */
            border-radius: 5px;
            outline: none;
            margin: 0 10px; /* Spacing around slider */
            transition: background 0.3s ease;
        }

        #speedSlider:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Slider Thumb (Chrome, Edge, Safari) */
        #speedSlider::-webkit-slider-thumb {
            appearance: none;
            width: 16px; /* Thumb width */
            height: 16px; /* Thumb height */
            background: #cccccc; /* Thumb color */
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid rgba(0, 0, 0, 0.5);
             transition: background 0.3s ease;
        }
        #speedSlider::-webkit-slider-thumb:hover {
             background: #ffffff;
        }

        /* Slider Thumb (Firefox) */
        #speedSlider::-moz-range-thumb {
            width: 14px; /* Thumb width */
            height: 14px; /* Thumb height */
            background: #cccccc; /* Thumb color */
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid rgba(0, 0, 0, 0.5);
            transition: background 0.3s ease;
        }
         #speedSlider::-moz-range-thumb:hover {
            background: #ffffff;
         }

         #speedValue {
             min-width: 40px; /* Ensure space for text */
             text-align: center;
             font-weight: 600;
             color: #e0e0e0;
         }

         /* Adjust menu controls alignment for RTL */
         body[dir="rtl"] .menu-controls {
             /* No specific change needed with gap, but could adjust order if required */
             flex-direction: row-reverse; /* Reverse items for RTL */
         }
         body[dir="rtl"] #speedControlContainer {
             /* Ensure label is on the right in RTL */
             flex-direction: row-reverse;
         }


    </style>
  </head>
  <body dir="rtl"> <div id="menuBar">
      <div id="title">FalakZoom</div>
      <div class="menu-controls">
        <div id="speedControlContainer">
          <span id="speedLabel">السرعة:</span> <input type="range" id="speedSlider" min="0" max="9" value="4" step="1"> <span id="speedValue">1x</span> </div>
        <div id="langToggleBtn">English</div>
        <div class="menu-item" id="planetsMenu">
          الكواكب
          <div class="dropdown" id="planetsDropdown">
            </div>
        </div>
      </div>
    </div>

    <div id="infoPanel">
      <span id="closeBtn">X</span>
      <h2 id="planetName"></h2>
      <p id="planetInfo"></p>
      <p id="planetFact" class="fact"></p>
      <button id="readMoreBtn"></button>
      <div id="extraFactsContainer" style="display: none;">
          </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
    <script>
      // --- Basic Setup ---
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // --- Controls ---
      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true; // Smooths camera movement
      controls.dampingFactor = 0.05;
      controls.screenSpacePanning = false; // Pan parallel to screen
      controls.minDistance = 5; // Prevent zooming too close
      controls.maxDistance = 200; // Prevent zooming too far

      // --- Lighting ---
      const ambientLight = new THREE.AmbientLight(0x404040, 1.5); // Soft white light
      scene.add(ambientLight);
      const pointLight = new THREE.PointLight(0xffffff, 3, 300); // Brighter sun light
      scene.add(pointLight); // Sun itself will be at (0,0,0)

      // --- Texture Loader ---
      const textureLoader = new THREE.TextureLoader();

      // --- Language and UI Text ---
      let currentLanguage = 'ar'; // Default language
      let currentlyDisplayedPlanetId = null; // Track displayed planet ID

      const uiText = {
          planetsMenu: { ar: "الكواكب", en: "Planets" },
          langToggle: { ar: "English", en: "العربية" },
          readMore: { ar: "اقرأ المزيد", en: "Read More" },
          hideFacts: { ar: "إخفاء الحقائق", en: "Hide Facts" }, // Added for button toggle
          speedLabel: { ar: "السرعة:", en: "Speed:"}, // Added for slider label
          // Add more UI elements as needed
      };

      // --- Planet Data with Multilingual Support & Extra Facts ---
      // (Using your provided planet data - shortened for brevity in thought process, but full data used here)
      const planetsData = [
        {
          id: 0, name: { ar: "الشمس", en: "Sun" },
          radius: 5, distance: 0, speed: 0, tilt: 0, rotation: 0.01, texture: "sun.jpg", // Example texture URL
          info: {
            ar: "القطر: 1.391 مليون كيلومتر\nالكتلة: 1.989 × 10³⁰ كيلوغرام\nالعمر: 4.6 مليار سنة\nالنوع: نجم من النوع G\nدرجة حرارة النواة: 15 مليون درجة مئوية",
            en: "Diameter: 1.391 million km\nMass: 1.989 × 10³⁰ kg\nAge: 4.6 billion years\nType: G-type main-sequence star\nCore Temperature: 15 million °C",
          },
          fact: {
            ar: "الشمس تحتوي على 99.86% من كتلة النظام الشمسي وهي مصدر الطاقة الرئيسي للحياة على الأرض.",
            en: "The Sun contains 99.86% of the Solar System's mass and is the primary source of energy for life on Earth.",
          },
          extraFacts: [
             { ar: "تولد الشمس الطاقة من خلال الاندماج النووي، محولة الهيدروجين إلى هيليوم في نواتها.", en: "The Sun generates energy through nuclear fusion, converting hydrogen into helium in its core." },
             { ar: "يستغرق ضوء الشمس حوالي 8 دقائق و 20 ثانية للوصول إلى الأرض.", en: "Light from the Sun takes about 8 minutes and 20 seconds to reach Earth." },
             { ar: "للشمس مجال مغناطيسي قوي يسبب ظواهر مثل البقع الشمسية والتوهجات الشمسية.", en: "The Sun has a powerful magnetic field, which causes phenomena like sunspots and solar flares." }
          ]
        },
        {
          id: 1, name: { ar: "عطارد", en: "Mercury" },
          radius: 0.5, distance: 10, speed: 0.0125, tilt: 0.034, rotation: 0.003, texture: "mercury.jpg", // Example texture URL
          info: {
            ar: "القطر: 4,879 كيلومتر\nالكتلة: 3.3 × 10²³ كيلوغرام\nالمدار: 88 يومًا\nدرجة حرارة السطح: من -173°م إلى 427°م\nلا يوجد غلاف جوي تقريبًا",
            en: "Diameter: 4,879 km\nMass: 3.3 × 10²³ kg\nOrbit: 88 days\nSurface Temp: -173°C to 427°C\nAlmost no atmosphere",
          },
          fact: {
             ar: "يوم واحد على عطارد (دورة شمسية) يستغرق حوالي 176 يومًا أرضيًا بسبب دورانه البطيء ومداره السريع.",
             en: "One solar day on Mercury lasts about 176 Earth days due to its slow rotation and fast orbit."
          },
          extraFacts: [
              { ar: "عطارد هو أصغر كواكب النظام الشمسي ولديه أكبر تقلبات في درجات الحرارة بين الليل والنهار.", en: "Mercury is the smallest planet and has the most extreme temperature fluctuations between day and night." },
              { ar: "يمتلك عطارد نواة حديدية ضخمة بشكل غير متناسب، تشكل حوالي 85% من قطر الكوكب.", en: "Mercury has a disproportionately large iron core, making up about 85% of the planet's radius."},
              { ar: "على الرغم من قربه من الشمس، اكتشف جليد مائي في الفوهات القطبية المظللة بشكل دائم على عطارد.", en: "Despite its proximity to the Sun, water ice has been detected in permanently shadowed polar craters on Mercury." }
          ]
        },
        {
          id: 2, name: { ar: "الزهرة", en: "Venus" },
          radius: 0.8, distance: 15, speed: 0.004375, tilt: 177.4, rotation: 0.0004, texture: "venus.jpg", // Example texture URL
          info: {
            ar: "القطر: 12,104 كيلومتر\nالكتلة: 4.87 × 10²⁴ كيلوغرام\nالمدار: 225 يومًا\nدرجة حرارة السطح: 464°م\nغلاف جوي كثيف من ثاني أكسيد الكربون",
            en: "Diameter: 12,104 km\nMass: 4.87 × 10²⁴ kg\nOrbit: 225 days\nSurface Temp: 464°C\nThick CO2 atmosphere",
          },
          fact: {
              ar: "الزهرة هي أسخن كواكب المجموعة الشمسية وتدور بعكس اتجاه دوران معظم الكواكب الأخرى (حركة تراجعية).",
              en: "Venus is the hottest planet and rotates backwards compared to most other planets (retrograde rotation)."
          },
          extraFacts: [
              { ar: "الضغط الجوي على سطح الزهرة يعادل الضغط الموجود على عمق 900 متر تحت سطح البحر على الأرض.", en: "The atmospheric pressure on Venus's surface is equivalent to the pressure 900 meters underwater on Earth." },
              { ar: "يوم واحد على الزهرة (243 يومًا أرضيًا) أطول من سنته (225 يومًا أرضيًا).", en: "A day on Venus (243 Earth days) is longer than its year (225 Earth days)." },
              { ar: "تتكون سحب الزهرة بشكل أساسي من قطرات حمض الكبريتيك.", en: "Venus's clouds are primarily composed of sulfuric acid droplets." }
          ]
        },
        {
           id: 3, name: { ar: "الأرض", en: "Earth" },
           radius: 1, distance: 20, speed: 0.003125, tilt: 23.5, rotation: 0.05, texture: "earth.jpg", // Example texture URL
           info: {
             ar: "القطر: 12,742 كيلومتر\nالكتلة: 5.97 × 10²⁴ كيلوغرام\nالمدار: 365.25 يومًا\nدرجة حرارة السطح: من -88°م إلى 58°م\nمغطاة بنسبة 71% بالمياه",
             en: "Diameter: 12,742 km\nMass: 5.97 × 10²⁴ kg\nOrbit: 365.25 days\nSurface Temp: -88°C to 58°C\n71% covered by water",
           },
           fact: {
             ar: "الأرض هي الكوكب الوحيد المعروف حاليًا بوجود حياة ومياه سائلة على سطحه.",
             en: "Earth is the only known planet to host life and have liquid water on its surface."
           },
           extraFacts: [
             { ar: "يحمي المجال المغناطيسي للأرض الكوكب من الإشعاع الشمسي الضار والرياح الشمسية.", en: "Earth's magnetic field protects the planet from harmful solar radiation and solar wind." },
             { ar: "تتكون الأرض من صفائح تكتونية تتحرك باستمرار، مسببة الزلازل والبراكين وتشكل الجبال.", en: "Earth is composed of tectonic plates that constantly move, causing earthquakes, volcanoes, and mountain formation." },
             { ar: "القمر، التابع الطبيعي الوحيد للأرض، يؤثر على المد والجزر ويثبت ميل محور دوران الأرض.", en: "The Moon, Earth's only natural satellite, influences tides and stabilizes Earth's axial tilt." }
           ]
        },
        {
           id: 4, name: { ar: "المريخ", en: "Mars" },
           radius: 0.7, distance: 25, speed: 0.0025, tilt: 25.2, rotation: 0.048, texture: "mars.jpg", // Example texture URL
           info: {
             ar: "القطر: 6,792 كيلومتر\nالكتلة: 6.42 × 10²³ كيلوغرام\nالمدار: 687 يومًا\nدرجة حرارة السطح: من -153°م إلى 20°م\nغلاف جوي رقيق من ثاني أكسيد الكربون",
             en: "Diameter: 6,792 km\nMass: 6.42 × 10²³ kg\nOrbit: 687 days\nSurface Temp: -153°C to 20°C\nThin CO2 atmosphere",
           },
           fact: {
             ar: "يُعرف المريخ بالكوكب الأحمر بسبب أكسيد الحديد (الصدأ) على سطحه، ولديه أعلى بركان وأكبر وادي في النظام الشمسي.",
             en: "Mars is known as the Red Planet due to iron oxide (rust) on its surface and has the tallest volcano and largest canyon in the Solar System."
           },
           extraFacts: [
             { ar: "للمريخ قمران صغيران، فوبوس وديموس، يُعتقد أنهما كويكبات تم أسرها.", en: "Mars has two small moons, Phobos and Deimos, which are thought to be captured asteroids." },
             { ar: "توجد أدلة قوية على وجود مياه سائلة على سطح المريخ في الماضي، وربما لا تزال موجودة تحت السطح.", en: "There is strong evidence that liquid water existed on Mars' surface in the past, and may still exist underground." },
             { ar: "تحدث على المريخ أكبر العواصف الترابية في النظام الشمسي، ويمكن أن تغطي الكوكب بأكمله.", en: "Mars experiences the largest dust storms in the Solar System, which can sometimes cover the entire planet." }
           ]
        },
        {
           id: 5, name: { ar: "المشتري", en: "Jupiter" },
           radius: 2.5, distance: 35, speed: 0.00125, tilt: 3.1, rotation: 0.1, texture: "jupiter.jpg", // Example texture URL
           info: {
             ar: "القطر: 139,820 كيلومتر\nالكتلة: 1.898 × 10²⁷ كيلوغرام\nالمدار: 11.86 سنة\nدرجة حرارة السطح (قمم السحب): -145°م\nعملاق غازي",
             en: "Diameter: 139,820 km\nMass: 1.898 × 10²⁷ kg\nOrbit: 11.86 years\nCloud Top Temp: -145°C\nGas giant",
           },
           fact: {
             ar: "المشتري هو أكبر كواكب المجموعة الشمسية وبه البقعة الحمراء العظيمة، وهي عاصفة ضخمة مستمرة منذ قرون.",
             en: "Jupiter is the largest planet and features the Great Red Spot, a giant storm raging for centuries."
           },
           extraFacts: [
             { ar: "يمتلك المشتري أقوى مجال مغناطيسي بين جميع الكواكب، وهو أقوى بحوالي 14 مرة من مجال الأرض.", en: "Jupiter has the strongest magnetic field of all planets, about 14 times stronger than Earth's." },
             { ar: "يدور المشتري حول محوره أسرع من أي كوكب آخر، حيث يستغرق يومه أقل من 10 ساعات.", en: "Jupiter rotates faster than any other planet, completing a rotation in just under 10 hours." },
             { ar: "للمشتري نظام حلقات خافت، بالإضافة إلى عدد كبير من الأقمار، بما في ذلك الأقمار الجاليلية الأربعة الكبيرة.", en: "Jupiter has a faint ring system and numerous moons, including the four large Galilean moons." }
           ]
        },
        // --- Add Saturn, Uranus, Neptune similarly ---
        {
           id: 6, name: { ar: "زحل", en: "Saturn" },
           radius: 2.2, distance: 45, speed: 0.0008125, tilt: 26.7, rotation: 0.09, texture: "saturn.jpg", // Example texture URL
           info: { ar: "القطر: 116,460 كم...", en: "Diameter: 116,460 km..." },
           fact: { ar: "يشتهر زحل بنظامه الحلقي المذهل...", en: "Saturn is famous for its stunning ring system..." },
           extraFacts: [{ar: "...", en:"..."}]
        },
        {
           id: 7, name: { ar: "أورانوس", en: "Uranus" },
           radius: 1.8, distance: 55, speed: 0.000625, tilt: 97.8, rotation: 0.07, texture: "uranus.jpg", // Example texture URL
           info: { ar: "القطر: 50,724 كم...", en: "Diameter: 50,724 km..." },
           fact: { ar: "يدور أورانوس على جانبه...", en: "Uranus rotates on its side..." },
           extraFacts: [{ar: "...", en:"..."}]
        },
        {
           id: 8, name: { ar: "نبتون", en: "Neptune" },
           radius: 1.7, distance: 65, speed: 0.0005, tilt: 28.3, rotation: 0.065, texture: "neptune.jpg", // Example texture URL
           info: { ar: "القطر: 49,244 كم...", en: "Diameter: 49,244 km..." },
           fact: { ar: "نبتون هو أبعد كوكب عن الشمس...", en: "Neptune is the farthest planet from the Sun..." },
           extraFacts: [{ar: "...", en:"..."}]
        },
      ];

      // --- Simulation State ---
      let planetObjects = []; // To store mesh and orbit data
      let focusedPlanetIndex = -1; // -1 means not focused
      let isFollowingPlanet = false; // Flag for camera follow mode
      let speedMultiplier = 1.0; // NEW: Global speed multiplier, default 1x
      const speedMultipliers = [0, 0.15, 0.25, 0.5, 1, 2, 4, 6, 8, 10]; // NEW: Multiplier levels

      // --- Create Planets and Orbits ---
      planetsData.forEach((planetData, index) => {
        // Planet Geometry and Material
        const geometry = new THREE.SphereGeometry(planetData.radius, 64, 64); // Increased segments for smoother spheres
        const material = new THREE.MeshStandardMaterial({
            map: textureLoader.load(planetData.texture, undefined, undefined, () => {
                // Error handling for textures (optional but good practice)
                console.error(`Failed to load texture for ${planetData.name.en}`);
                // Could load a placeholder texture here
            }),
            metalness: 0.1, // Slight metalness for realism
            roughness: 0.8, // Adjust roughness
        });

        // Special handling for the Sun (emissive)
        if (planetData.id === 0) {
            material.emissive = new THREE.Color(0xffffdd); // Give sun a glow
            material.emissiveIntensity = 1.5; // Adjust intensity of glow
             material.metalness = 0; // Sun isn't metallic
             material.roughness = 1; // Sun isn't smooth
        }

        const mesh = new THREE.Mesh(geometry, material);
        mesh.rotation.x = THREE.MathUtils.degToRad(planetData.tilt); // Apply axial tilt
        mesh.userData = { id: planetData.id, name: planetData.name }; // Store ID and name for picking

        // Orbit Path (Visualisation)
        let orbit = null;
        if (planetData.distance > 0) {
          const orbitGeometry = new THREE.RingGeometry(
            planetData.distance - 0.1, // Inner radius
            planetData.distance + 0.1, // Outer radius
            128 // Segments for smoothness
          );
          const orbitMaterial = new THREE.MeshBasicMaterial({
            color: 0xffffff,
            opacity: 0.2, // Make orbits faint
            transparent: true,
            side: THREE.DoubleSide,
          });
          orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
          orbit.rotation.x = Math.PI / 2; // Rotate ring to lie flat on XZ plane
          scene.add(orbit);
        }

        // Store planet mesh and its initial angle for animation
        planetObjects.push({ mesh, angle: Math.random() * Math.PI * 2, orbit }); // Random initial angle
        scene.add(mesh);
      });

      // --- Comet ---
      const cometGeometry = new THREE.ConeGeometry(0.3, 1.5, 16); // Cone shape
      const cometMaterial = new THREE.MeshStandardMaterial({
          color: 0xaaaaff,
          emissive: 0x8888ff, // Give it a slight glow
          emissiveIntensity: 0.5,
          roughness: 0.5,
          metalness: 0.2
      });
      const comet = new THREE.Mesh(cometGeometry, cometMaterial);
      scene.add(comet);

      // --- Camera Initial Position ---
      camera.position.set(0, 40, 80); // Start further back
      controls.target.set(0, 0, 0); // Look at the center (Sun)

      // --- Raycasting for Planet Selection ---
      const raycaster = new THREE.Raycaster();
      const mouse = new THREE.Vector2();

      function onMouseClick(event) {
        // Calculate mouse position in normalized device coordinates (-1 to +1)
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        // Update the picking ray with the camera and mouse position
        raycaster.setFromCamera(mouse, camera);

        // Calculate objects intersecting the picking ray
        const intersects = raycaster.intersectObjects(
          planetObjects.map((p) => p.mesh) // Only check planet meshes
        );

        if (intersects.length > 0) {
          const clickedObject = intersects[0].object;
          const planetId = clickedObject.userData.id;
          displayPlanetInfo(planetId);
          focusOnPlanet(planetId); // Focus camera on clicked planet
        } else {
          // Clicked on empty space - potentially unfocus or reset view
          // hideInfoPanel(); // Optionally hide panel on empty click
          // resetFocus(); // Optionally reset focus
        }
      }
      window.addEventListener('click', onMouseClick);

      // --- UI Elements ---
      const infoPanel = document.getElementById('infoPanel');
      const planetNameEl = document.getElementById('planetName');
      const planetInfoEl = document.getElementById('planetInfo');
      const planetFactEl = document.getElementById('planetFact');
      const closeBtn = document.getElementById('closeBtn');
      const planetsMenu = document.getElementById('planetsMenu');
      const planetsDropdown = document.getElementById('planetsDropdown');
      const langToggleBtn = document.getElementById('langToggleBtn');
      const body = document.body;
      const readMoreBtn = document.getElementById('readMoreBtn');
      const extraFactsContainer = document.getElementById('extraFactsContainer');
      const speedSlider = document.getElementById('speedSlider'); // NEW: Get slider
      const speedValueEl = document.getElementById('speedValue'); // NEW: Get speed display element
      const speedLabelEl = document.getElementById('speedLabel'); // NEW: Get speed label element


      // --- UI Functions ---
      function displayPlanetInfo(planetId) {
        const planetData = planetsData.find((p) => p.id === planetId);
        if (!planetData) return;

        currentlyDisplayedPlanetId = planetId; // Track displayed planet

        planetNameEl.textContent = planetData.name[currentLanguage];
        planetInfoEl.textContent = planetData.info[currentLanguage];
        planetFactEl.textContent = planetData.fact[currentLanguage];

        // Populate Extra Facts
        extraFactsContainer.innerHTML = ''; // Clear previous facts
        if (planetData.extraFacts && planetData.extraFacts.length > 0) {
            planetData.extraFacts.forEach(fact => {
                const p = document.createElement('p');
                p.textContent = fact[currentLanguage];
                extraFactsContainer.appendChild(p);
            });
            readMoreBtn.style.display = 'block'; // Show button if facts exist
            readMoreBtn.textContent = uiText.readMore[currentLanguage]; // Set initial text
            extraFactsContainer.style.display = 'none'; // Hide initially
        } else {
            readMoreBtn.style.display = 'none'; // Hide button if no extra facts
        }

        infoPanel.style.display = 'block';
      }

      function hideInfoPanel() {
        infoPanel.style.display = 'none';
        currentlyDisplayedPlanetId = null; // Reset tracked planet
      }

      function populatePlanetsDropdown() {
        planetsDropdown.innerHTML = ''; // Clear existing items
        planetsData.forEach((planet) => {
          const item = document.createElement('a');
          item.href = '#';
          item.classList.add('dropdown-item');
          item.textContent = planet.name[currentLanguage];
          item.onclick = (e) => {
            e.preventDefault();
            displayPlanetInfo(planet.id);
            focusOnPlanet(planet.id); // Also focus camera
            hideDropdown(); // Close dropdown after selection
          };
          planetsDropdown.appendChild(item);
        });
      }

      function toggleDropdown() {
        planetsDropdown.classList.toggle('show');
      }

      function hideDropdown() {
        planetsDropdown.classList.remove('show');
      }

      function updateLanguageUI() {
          body.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr'; // Set text direction

          // Update static text elements
          planetsMenu.firstChild.textContent = uiText.planetsMenu[currentLanguage] + ' '; // Update menu text (keep space for dropdown arrow)
          langToggleBtn.textContent = uiText.langToggle[currentLanguage];
          readMoreBtn.textContent = extraFactsContainer.style.display === 'none'
              ? uiText.readMore[currentLanguage]
              : uiText.hideFacts[currentLanguage];
          speedLabelEl.textContent = uiText.speedLabel[currentLanguage]; // NEW: Update speed label

          // Repopulate dynamic elements
          populatePlanetsDropdown();

          // Update info panel if visible
          if (currentlyDisplayedPlanetId !== null) {
              displayPlanetInfo(currentlyDisplayedPlanetId); // Re-render with new language
          }
      }

      function toggleLanguage() {
          currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
          updateLanguageUI();
      }

      // --- Camera Focus ---
      function focusOnPlanet(planetId) {
        const planetIndex = planetObjects.findIndex(
          (p) => p.mesh.userData.id === planetId
        );
        if (planetIndex === -1) return;

        focusedPlanetIndex = planetIndex;
        isFollowingPlanet = true; // Enable follow mode

        // Don't instantly snap, let the animate loop handle smooth transition
        // controls.target.copy(planetObjects[planetIndex].mesh.position); // Set target immediately
      }

      function resetFocus() {
          focusedPlanetIndex = -1;
          isFollowingPlanet = false;
          // Smoothly move camera back to overview
          // Target the sun (or origin)
          const targetPosition = new THREE.Vector3(0, 0, 0);
          // A suitable overview position
          const overviewPosition = new THREE.Vector3(0, 40, 80);

          // Use a tweening library (like TWEEN.js) for smoother transitions,
          // or simply lerp in the animate loop (simpler approach):
          // Set a flag or target state for the animate loop to handle transition
          // For now, just set the target for OrbitControls
          controls.target.copy(targetPosition);
      }


      // --- Event Listeners ---
      closeBtn.addEventListener('click', hideInfoPanel);
      planetsMenu.addEventListener('click', (e) => {
          // Prevent hiding if clicking inside dropdown
          if (!planetsDropdown.contains(e.target)) {
              toggleDropdown();
          }
      });
      langToggleBtn.addEventListener('click', toggleLanguage);

      // Hide dropdown if clicking outside
      window.addEventListener('click', (event) => {
        if (!planetsMenu.contains(event.target)) {
          hideDropdown();
        }
        // If clicking outside the info panel when it's open, optionally hide it
        // if (infoPanel.style.display === 'block' && !infoPanel.contains(event.target) && event.target !== closeBtn) {
        //    hideInfoPanel();
        // }
      });

      // Read More Button Logic
      readMoreBtn.addEventListener('click', () => {
          const isHidden = extraFactsContainer.style.display === 'none';
          extraFactsContainer.style.display = isHidden ? 'block' : 'none';
          readMoreBtn.textContent = isHidden ? uiText.hideFacts[currentLanguage] : uiText.readMore[currentLanguage];
          // Scroll info panel to the top of extra facts when shown
          if (isHidden) {
              infoPanel.scrollTop = readMoreBtn.offsetTop - 10; // Adjust scroll position
          }
      });

      // Window Resize
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      // Double Click to Reset Focus
      window.addEventListener('dblclick', resetFocus);

      // --- NEW: Speed Slider Logic ---
      speedSlider.addEventListener('input', (event) => {
          const sliderValue = parseInt(event.target.value, 10); // Value from 0 to 9
          speedMultiplier = speedMultipliers[sliderValue]; // Get multiplier from array
          speedValueEl.textContent = `${speedMultiplier}x`; // Update display text
      });


      // --- Animation Loop ---
      function animate() {
        requestAnimationFrame(animate);

        const currentTime = Date.now();

        // Animate Planets (Orbit and Rotation)
        planetObjects.forEach((p, index) => {
          const planetData = planetsData[index];
          const mesh = p.mesh;

          // Rotation around own axis (influenced by speedMultiplier)
          mesh.rotation.y += planetData.rotation * 0.1 * speedMultiplier; // Apply speed multiplier

          // Orbit around the Sun (influenced by speedMultiplier)
          if (planetData.distance > 0) {
            // Use the stored angle and increment it
            p.angle += planetData.speed * 0.5 * speedMultiplier; // Apply speed multiplier
            mesh.position.x = Math.cos(p.angle) * planetData.distance;
            mesh.position.z = Math.sin(p.angle) * planetData.distance;
          }

          // Camera Following Logic
          if (isFollowingPlanet && index === focusedPlanetIndex) {
                const currentTargetPosition = mesh.position.clone();
                // Smoothly move the controls target towards the planet
                controls.target.lerp(currentTargetPosition, 0.05);

                // Calculate desired camera position relative to the planet
                const offsetDistance = planetData.radius * (planetData.id === 0 ? 5 : 8); // Adjust offset based on planet size (larger for sun)

                // Maintain relative camera orientation if possible, or calculate offset
                // Simple offset calculation:
                const offset = new THREE.Vector3();
                offset.subVectors(camera.position, controls.target); // Get current offset vector
                offset.normalize().multiplyScalar(offsetDistance); // Keep direction, adjust distance

                const desiredPosition = currentTargetPosition.clone().add(offset);

                // Smoothly move camera towards the desired position
                camera.position.lerp(desiredPosition, 0.05); // Adjust lerp factor for speed
           }
        });


         // Animate Comet (Simple elliptical orbit, independent of slider for now)
         const cometTime = currentTime * 0.0002; // Base speed for comet
         const cometSemiMajor = 80;
         const cometSemiMinor = 50;
         comet.position.x = Math.cos(cometTime) * cometSemiMajor;
         comet.position.z = Math.sin(cometTime) * cometSemiMinor;
         comet.position.y = Math.sin(cometTime * 0.7) * 15; // Add some vertical movement

         // Make comet point away from the sun (approximate tail direction)
         const dirToSun = comet.position.clone().normalize().negate();
         comet.lookAt(comet.position.clone().add(dirToSun));


        // Update OrbitControls
        controls.update();

        // Render Scene
        renderer.render(scene, camera);
      }

      // --- Initial Setup Calls ---
      updateLanguageUI(); // Set initial language and populate UI
      animate(); // Start the animation loop
    </script>
  </body>
</html>
